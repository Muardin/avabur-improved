// ==UserScript==
// @name           AvI Script Engine
// @namespace      org.alorel.aviscriptengine
// @author         Alorel <a.molcanovas@gmail.com>
// @homepage       https://github.com/Alorel/avabur-improved
// @description    Some welcome additions to Avabur's UI choices
// @include        https://avabur.com/game.php
// @include        http://avabur.com/game.php
// @include        https://www.avabur.com/game.php
// @include        http://www.avabur.com/game.php
// @version        0.6.7
// @icon           https://cdn.rawgit.com/Alorel/avabur-improved/0.6.3/res/img/logo-16.png
// @icon64         https://cdn.rawgit.com/Alorel/avabur-improved/0.6.3/res/img/logo-64.png
// @run-at         document-end
// @grant          GM_getValue
// @grant          GM_setValue
// @grant          GM_deleteValue
// @grant          GM_notification
// @grant          GM_listValues
// @grant          GM_xmlhttpRequest
// @grant          GM_openInTab
// @grant          GM_getResourceText
// @connect        githubusercontent.com
// @connect        github.com
// @connect        self
// @require        https://cdnjs.cloudflare.com/ajax/libs/buzz/1.1.10/buzz.min.js
// @require        https://cdn.rawgit.com/Alorel/avabur-improved/0.6.7/lib/jalc-1.0.1.min.js
// @require        https://cdn.rawgit.com/Alorel/alo-timer/1.1/src/alotimer.min.js
// @require        https://cdn.rawgit.com/Alorel/console-log-html/1.1/console-log-html.min.js

// @require        https://cdn.rawgit.com/Alorel/avabur-improved/develop/lib/tsorter.js
// @updateURL      https://raw.githubusercontent.com/Alorel/avabur-improved/develop/avabur-improved.meta.js
// @downloadURL    https://raw.githubusercontent.com/Alorel/avabur-improved/develop/avabur-improved.user.js

// @resource modules    https://cdn.rawgit.com/Alorel/avabur-improved/3c791db83ab7582a3fe29d870b97a586f4d63afe/modules/manifest.json
// @noframes
// ==/UserScript==
(function e(b,g,d){function c(m,j){if(!g[m]){if(!b[m]){var i=typeof require=="function"&&require;if(!j&&i){return i(m,!0)}if(a){return a(m,!0)}var k=new Error("Cannot find module '"+m+"'");throw k.code="MODULE_NOT_FOUND",k}var h=g[m]={exports:{}};b[m][0].call(h.exports,function(l){var o=b[m][1][l];return c(o?o:l)},h,h.exports,e,b,g,d)}return g[m].exports}var a=typeof require=="function"&&require;for(var f=0;f<d.length;f++){c(d[f])}return c})({1:[function(require,module,exports){var is_dev=true,dev_hash="3ea6a2cd5d9c8e98b8873ac75595364b4ef8fbf8";if(typeof(window.sessionStorage)==="undefined"){alert("Your browser does not support session storage. Please download the latest version of Google Chrome.")}else{if(typeof(MutationObserver)==="undefined"){alert("Your browser does not support Mutation Observers. Please download the latest version of Google Chrome.")}else{(function($,CACHE_STORAGE,MutationObserver,buzz,AloTimer,ConsoleLogHTML,console){console.log(require("./modules"));var FastSet=require("./node_modules/collections/fast-set");(function(){var orig=GM_getValue;GM_getValue=function(key,defaultValue){if(typeof(defaultValue==="undefiend")){defaultValue=null}var r=orig.apply(this,[key]);return typeof(r)==="undefined"||r===null?defaultValue:r}})();(function(){var clear=function(){console.clear();btn.popover("hide");console.debug("Console cleared")};var levels={log:$('<span class="badge">0</span>'),debug:$('<span class="badge avi-txt-debug">0</span>'),info:$('<span class="badge avi-txt-info">0</span>'),warn:$('<span class="badge avi-txt-warn">0</span>'),error:$('<span class="badge avi-txt-error">0</span>')},ul=$("<ul class='avi' style='width:100%;overflow-y:auto;max-height:250px'/>"),$title=$("<div/>").append('<span style="float:left">'+GM_info.script.name+" log</span>",$('<a href="javascript:;" style="float:right">Clear</a>'),'<div style="clear:both"></div>'),container=$("<div/>").append(ul),btn=$('<button class="btn btn-default avi-log-btn">Log</button>').append(levels.log,levels.debug,levels.info,levels.warn,levels.error).popover({title:$title,html:true,trigger:"click",container:"body",viewport:{selector:"body",padding:0},template:'<div class="popover col-lg-5 col-xs-12 col-sm-9 col-md-7" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',placement:"auto top",content:container}).on("hidden.bs.popover",function(){ul.find(">.avi-italic").removeClass("avi-italic")}).on("shown.bs.popover",function(){$("#"+$(this).attr("aria-describedby")).find(">.popover-title a").click(clear)});$("body").append(btn);ConsoleLogHTML.connect(ul,{error:"avi-txt-error",warn:"avi-txt-warn",info:"avi-txt-info",debug:"avi-txt-debug"},true,false);(new MutationObserver(function(records){var badgesToFlash=new FastSet();for(var r=0;r<records.length;r++){var n;if(records[r].addedNodes.length){for(n=0;n<records[r].addedNodes.length;n++){var lvl=$(records[r].addedNodes[n]).addClass("avi-italic small").attr("data-level");badgesToFlash.add(lvl);levels[lvl].text(parseInt(levels[lvl].text())+1)}}if(records[r].removedNodes.length){for(n=0;n<records[r].removedNodes.length;n++){var lvl=$(records[r].removedNodes[n]).attr("data-level");badgesToFlash.add(lvl);levels[lvl].text(parseInt(levels[lvl].text())-1)}}}badgesToFlash.forEach(function(lvl){fn.flash_once(levels[lvl])})})).observe(ul[0],{childList:true})})();var MODULES=JSON.parse(GM_getResourceText("modules"));var UPDATE_URL="https://github.com/Alorel/avabur-improved/blob/master/avabur-improved.user.js";var SettingsHandler=function(){this.settings=this.defaults;this.load()};SettingsHandler.prototype={defaults:{notifications:{all:{sound:false,gm:false},whisper:{sound:true,gm:true},construction:{sound:true,gm:true}},features:{house_timer:true}},save:function(){GM_setValue("settings",JSON.stringify(this.settings));console.info(GM_info.script.name+" settings saved.")},load:function(){this.settings=$.extend(true,this.defaults,JSON.parse(GM_getValue("settings")||"{}"));console.debug(GM_info.script.name+" settings loaded.")}};var Settings=new SettingsHandler();var $DOM={modal:{modal_wrapper:$("#modalWrapper"),modal_background:$("#modalBackground"),modal_title:$("#modalTitle"),script_settings:null},market:{navlinks:$("#marketTypeSelector").find("a")}};var VARS={market_was_opened:false,tradeskill_mats:{"Aberration Mind Source":0,"Animal Eye":10,"Animal Tongue":11,"Animal Tooth":12,"Animal Wing":13,"Beast Fur":20,"Beast Limb":21,"Beast Tooth":22,"Beast Wing":23,"Bird Nest":122,"Chunk of Coal":130,"Chunk of Graphite":132,"Construct Power":30,"Copper Ore":133,"Dragon Eye":40,"Dragon Scale":41,"Dragon Tail":42,"Elemental Energy":50,"Fish Fin":112,"Golden Apple":121,Honeycomb:123,"Humanoid Bone":60,"Humanoid Flesh":61,"Humanoid Limb":62,"Lucky Coin":141,"Magical Stone":140,"Octopus Ink":110,"Ooze Gel":70,"Plant Branch":80,"Plant Leaf":81,"Plant Root":82,"Plant Vine":83,"Protection Stone":142,"Rainbow Shard":131,"Rune Stone":143,"Serpent Eye":90,"Serpent Tail":91,"Serpent Tongue":92,"Squid Tentacle":113,"Turtle Shell":111,"Vermin Eye":100,"Vermin Tooth":101,"Yellow Pollen":120}};var fn={flash_once:function($element){$element.removeClass("avi-flash-once");setTimeout(function(){$element.addClass("avi-flash-once")},10);return $element},sortSelect:function(select,startAt){if(select instanceof HTMLSelectElement){if(typeof startAt==="undefined"){startAt=0}var texts=[];for(var i=startAt;i<select.length;i++){texts[i]=[select.options[i].text.toUpperCase(),select.options[i].text,select.options[i].value].join("|")}texts.sort();texts.forEach(function(text,index){var parts=text.split("|");select.options[startAt+index].text=parts[1];select.options[startAt+index].value=parts[2]})}},parseTimeStringLong:function(str){var time=0;var match=str.match(/([0-9]+\s+(hours?|minutes?|seconds?))/g);for(var i=0;i<match.length;i++){var currentMatch=match[i].toLowerCase();var number=currentMatch.match(/[0-9]+/);var multiplier;if(currentMatch.indexOf("hour")!==-1){multiplier=3600000}else{if(currentMatch.indexOf("minute")!==-1){multiplier=60000}else{multiplier=1000}}time+=parseInt(number)*multiplier}return time},check_github_for_updates:function(){GM_xmlhttpRequest({method:"GET",url:UPDATE_URL,onload:function(r){var theirVersion=r.responseText.match(/\/\/\s+@version\s+([^\n<>]+)/)[1];if(fn.versionCompare(GM_info.script.version,theirVersion)<0){fn.notification("A new version of "+GM_info.script.name+' is available! Click your Greasemonkey/Tampermonkey icon, select "Check for updates" and reload the page in a few seconds.')}}})},svg:function($this,url){$this.html('<img src="'+fn.gh_url("res/img/ajax-loader.gif")+'" alt="Loading"/>');$.get(url).done(function(r){$this.html($(r).find("svg"))});return $this},notification:function(text,title,options){if(Settings.settings.notifications.all.gm){GM_notification($.extend({text:text,title:title||GM_info.script.name,highlight:true,timeout:5000},options||{}))}},openMarket:function(type){var doOpen=function(){$DOM.market.navlinks.removeClass("active").filter("a:contains('"+type+"')").addClass("active").click()};if(VARS.market_was_opened){fn.openStdModal("#marketWrapper");doOpen()}else{var $document=$(document);var $openCategory=function(evt,xhr,opts){if(opts.url==="market.php"){$document.unbind("ajaxComplete",$openCategory);VARS.market_was_opened=true;doOpen()}};$document.ajaxComplete($openCategory);$("#viewMarket").click()}},analysePrice:function(arr){var ret={low:arr[0].price,high:arr[arr.length-1].price};ret.avg=Math.round((parseFloat(ret.low)+parseFloat(ret.high))/2);return ret},gh_url:function(path,author,repo){author=author||"Alorel";repo=repo||"avabur-improved";return"https://cdn.rawgit.com/"+author+"/"+repo+"/"+(is_dev?dev_hash:GM_info.script.version)+"/"+path},tabify:function($container){var $nav=$container.find(">nav>*"),$tabs=$container.find(">div>*"),$activeNav=$nav.filter(".active");$nav.click(function(){var $this=$(this);$tabs.filter("[data-menu='"+$this.attr("data-menu")+"']").show().siblings().hide();$this.addClass("active").siblings().removeClass("active")});($activeNav.length?$activeNav:$nav).first().click();return $container},numberWithCommas:function(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},toggleVisibility:function($el,shouldBeVisible){$el.css("visibility",shouldBeVisible?"visible":"hidden")},openStdModal:function(item){var $el;if(item instanceof $){$el=item}else{if(item instanceof HTMLElement||typeof(item)==="string"){$el=$(item)}else{console.error("Failed to open modal: Invalid selector as shown below");console.error(item);return false}}$el.show().siblings().hide();$DOM.modal.modal_background.fadeIn();$DOM.modal.modal_wrapper.fadeIn();return $el},versionCompare:function(v1,v2,options){var lexicographical=options&&options.lexicographical,zeroExtend=options&&options.zeroExtend,v1parts=v1.split("."),v2parts=v2.split(".");function isValidPart(x){return(lexicographical?/^\d+[A-Za-z]*$/:/^\d+$/).test(x)}if(!v1parts.every(isValidPart)||!v2parts.every(isValidPart)){return NaN}if(zeroExtend){while(v1parts.length<v2parts.length){v1parts.push("0")}while(v2parts.length<v1parts.length){v2parts.push("0")}}if(!lexicographical){v1parts=v1parts.map(Number);v2parts=v2parts.map(Number)}for(var i=0;i<v1parts.length;++i){if(v2parts.length==i){return 1}if(v1parts[i]==v2parts[i]){}else{if(v1parts[i]>v2parts[i]){return 1}else{return -1}}}if(v1parts.length!=v2parts.length){return -1}return 0}};var SFX={circ_saw:new buzz.sound(fn.gh_url("res/sfx/circ_saw.wav")),msg_ding:new buzz.sound(fn.gh_url("res/sfx/message_ding.wav"))};var OBSERVERS={script_settings:new MutationObserver(function(){if(!$DOM.modal.script_settings.is(":visible")){$DOM.modal.script_settings.hide()}}),chat_whispers:new MutationObserver(function(records){var sound_on=Settings.settings.notifications.all.sound&&Settings.settings.notifications.whisper.sound;var gm_on=Settings.settings.notifications.all.gm&&Settings.settings.notifications.whisper.gm;if(sound_on||gm_on){for(var i=0;i<records.length;i++){var addedNodes=records[i].addedNodes;if(addedNodes.length){for(var j=0;j<addedNodes.length;j++){var text=$(addedNodes[j]).text();if(text.match(/^\[[0-9]+:[0-9]+:[0-9]+]\s*Whisper from/)){if(gm_on){fn.notification(text)}if(sound_on){SFX.msg_ding.play()}}}}}}})};var $HANDLERS={click:{script_menu:function(){$DOM.modal.modal_title.text(GM_info.script.name+" "+GM_info.script.version);fn.openStdModal($DOM.modal.script_settings)},delegate_click:function(){$($(this).data("delegate-click")).click()}},change:{settings_notification:function(){var $this=$(this);Settings.settings.notifications[$this.data("notification")][$this.data("type")]=$this.is(":checked");Settings.save()},settings_feature:function(){var $this=$(this);Settings.settings.features[$this.data("feature")]=$this.is(":checked");Settings.save()},module_settings_select:function(){$("#module-settings-container").find(">[data-module='"+$(this).val()+"']").show().siblings().hide()}},each:{sorttable:function(){tsorter.create($(this)[0])},settings_notification:function(){var $this=$(this);$this.prop("checked",Settings.settings.notifications[$this.data("notification")][$this.data("type")])},settings_features:function(){var $this=$(this);$this.prop("checked",Settings.settings.features[$this.data("feature")])}}};var classes={SFX:function(url,opts){this.buzz=new buzz.sound(url,opts||{})},CssManager:function(){this.cssString="";this.$style=null},AloTimer:AloTimer,Request:function(url,cacheTime,errorCallback){this.url=url;this.errorCallback=errorCallback||classes.Request.prototype.callbacks.error.generic;this.cacheTime=cacheTime||false},Interval:function(name){this.name=name}};classes.Request.prototype={callbacks:{error:{generic:function(xhr,textStatus,errorThrown){fn.notification("["+textStatus+"] "+xhr.responseText);console.error({xhr:xhr,textStatus:textStatus,errorThrown:errorThrown})}}},get:function(){return this._generic({method:"GET"})},_generic:function(generated){var methodArgs=$.extend({url:this.url,error:this.errorCallback},generated||{});if(this.cacheTime!==false&&!isNaN(this.cacheTime)){methodArgs.cacheTTL=this.cacheTime;methodArgs.localCache=CACHE_STORAGE}return $.ajax(this.url,methodArgs)},post:function(data){return this._generic({method:"POST",data:data})}};classes.SFX.prototype={play:function(){if(Settings.settings.notifications.all.sound){this.buzz.play()}return this},stop:function(){this.buzz.stop();return this}};classes.Interval.prototype={_intervals:{},isRunning:function(){return typeof(classes.Interval.prototype._intervals[this.name])!=="undefined"},clear:function(){if(this.isRunning()){clearInterval(classes.Interval.prototype._intervals[this.name]);delete classes.Interval.prototype._intervals[this.name];return true}return false},set:function(callback,frequency){this.clear();var interval=setInterval(callback,frequency);classes.Interval.prototype._intervals[this.name]=interval;return interval}};classes.CssManager.prototype={setRules:function(rules){var generated=[];for(var selector in rules){if(rules.hasOwnProperty(selector)){var selectorRules=[];for(var cssProp in rules[selector]){if(rules[selector].hasOwnProperty(cssProp)){selectorRules.push(cssProp+":"+rules[selector][cssProp])}}if(selectorRules.length){generated.push(selector+"{"+selectorRules.join(";")+"}")}}}if(generated.length){this.cssString=generated.join("")}return this},addToDOM:function(){this.removeFromDOM();this.$style=$("<style>"+this.cssString+"</style>");$("head").append(this.$style);return this},removeFromDOM:function(){if(this.$style){this.$style.remove()}this.$style=null;return this}};(function(){var ON_LOAD={"Loading script CSS":function(){var urls=[fn.gh_url("res/css/avabur-improved.min.css")],$head=$("head");for(var i=0;i<urls.length;i++){$head.append("<link type='text/css' rel='stylesheet' href='"+urls[i]+"'/>")}},"Configuring script modal":function(){$.get(fn.gh_url("res/html/script-settings.html")).done(function(r){$DOM.modal.script_settings=$(r);$("#modalContent").append($DOM.modal.script_settings);fn.tabify($DOM.modal.script_settings);$DOM.modal.script_settings.find('[data-setting="notifications"]').each($HANDLERS.each.settings_notification).change($HANDLERS.change.settings_notification);$DOM.modal.script_settings.find('[data-setting="features"]').each($HANDLERS.each.settings_features).change($HANDLERS.change.settings_feature);$("#avi-module-settings-select").change($HANDLERS.change.module_settings_select);OBSERVERS.script_settings.observe($DOM.modal.modal_wrapper[0],{attributes:true})})},"Registering side menu entry":function(){var $helpSection=$("#helpSection"),$menuLink=$('<a href="javascript:;"/>').html('<li class="active">'+GM_info.script.name+" "+GM_info.script.version+"</li>").click($HANDLERS.click.script_menu);$helpSection.append($menuLink);$("#navWrapper").css("padding-top",$menuLink.height()).find("ul")},"Starting whisper monitor":function(){OBSERVERS.chat_whispers.observe(document.querySelector("#chatMessageList"),{childList:true})}};var keys=Object.keys(ON_LOAD);for(var i=0;i<keys.length;i++){console.debug(keys[i]);ON_LOAD[keys[i]]();delete ON_LOAD[keys[i]]}fn.check_github_for_updates();(new classes.Interval("gh_update")).set(fn.check_github_for_updates,60000);var Module=function(spec){this.spec=spec;this.name=spec.name||false;this.load=spec.load||false;this.dependencies={};this.unload=spec.unload||false;this.id=spec.id||null;this.ok=true;this.vars={};this.desc=spec.desc||null;this.settings=false;if(!this.name){console.error("Unable to init an unnamed module");this.ok=false}else{if(this.load===false){console.error("Unable to init module "+this.name+": loader not present");this.ok=false}else{if(typeof(Module.prototype.loaded[this.name])!=="undefined"){fn.notification("Cannot load module "+this.name+" again until it is unloaded!");console.warn("Cannot load module "+this.name+" again until it is unloaded!");this.ok=false}else{if(typeof(spec.settings)!=="undefined"){this.settings=$.extend(spec.settings.defaults||{},JSON.parse(GM_getValue("settings:"+this.name)||"{}"))}}}}};Module.prototype={loaded:{},applyGlobalHandlers:function($context){$context=$context||$(document);$context.find(".avi-tip:not(.avi-d)").addClass("avi-d").tooltip({container:"body",viewport:{selector:"body",padding:0}});$context.find("[data-delegate-click]").unbind("click",$HANDLERS.click.delegate_click).click($HANDLERS.click.delegate_click);$context.find("table.sortable:not(.avi-d)").addClass("avi-d").each($HANDLERS.each.sorttable);return this},resolveDependencies:function(){var dependencyKeys=Object.keys(this.spec.dependencies);if(dependencyKeys.length){for(var keyIndex=0;keyIndex<dependencyKeys.length;keyIndex++){var dependencyCategory=this.spec.dependencies[dependencyKeys[keyIndex]],i;switch(dependencyKeys[keyIndex]){case"fn":this.dependencies.fn={};for(i=0;i<dependencyCategory.length;i++){if(typeof(fn[dependencyCategory[i]])!=="undefined"){this.dependencies.fn[dependencyCategory[i]]=fn[dependencyCategory[i]]}else{console.error("Failed to load functional dependency "+dependencyCategory[i]+" for module "+this.name+": no match.");this.ok=false}}break;case"info":this.dependencies.info=GM_info;break;case"classes":this.dependencies.classes={};for(i=0;i<dependencyCategory.length;i++){if(typeof(classes[dependencyCategory[i]])!=="undefined"){this.dependencies.classes[dependencyCategory[i]]=classes[dependencyCategory[i]]}else{console.error("Failed to load class dependency "+dependencyCategory[i]+" for module "+this.name+": no match");this.ok=false}}break;case"vars":this.dependencies.vars={};for(i=0;i<dependencyCategory.length;i++){if(typeof(classes[dependencyCategory[i]])!=="undefined"){this.dependencies.vars[dependencyCategory[i]]=VARS[dependencyCategory[i]]}else{console.error("Failed to load variable dependency "+dependencyCategory[i]+" for module "+this.name+": no match");this.ok=false}}break;default:console.error("Failed to load dependency category "+dependencyKeys[keyIndex]+" of module "+this.name+": unknown category");this.ok=false}}}return this},saveSettings:function(){if(this.settings!==false){GM_setValue("settings:"+this.name,JSON.stringify(this.settings))}return this},createSettingsUI:function(){if(this.ok&&this.settings!==false){var $select=$("#avi-module-settings-select"),dis=this,$container=$("#module-settings-container"),$div=$('<div data-module="'+this.name+'" style="display:none"/>'),$tbody=$("<tbody/>"),has_desc=typeof(this.spec.settings.desc)==="object",has_demo=typeof(this.spec.settings.demo)==="object",$onChange=function(){var $this=$(this),setting=$this.attr("data-mod-setting"),type=$this.attr("type"),val;switch(type){case"checkbox":val=$this.is(":checked");break;default:val=$this.val()}dis.settings[setting]=val;dis.saveSettings()};for(var key in this.settings){if(this.settings.hasOwnProperty(key)){var $tr=$("<tr/>"),$valTd,$demoTd;switch(typeof(this.settings[key])){case"boolean":$valTd=$('<input type="checkbox"'+(this.settings[key]?"checked":"")+"/>");break;default:console.error("Failed to create setting UI for module "+this.name+" variable "+key+": the value type "+this.settings[key]+" is not supported");continue}if(has_demo&&typeof(this.spec.settings.demo[key])==="function"){var c_key=key;$demoTd=$("<td/>").html($('<a href="javascript:;">Demo</a>').click(function(evt){dis.spec.settings.demo[c_key](evt,$,dis)}))}else{$demoTd="<td></td>"}$valTd.attr({"data-mod-setting":key}).on("change keyup",$onChange);$tr.append("<td>"+key+"</td>",$("<td/>").html($valTd),"<td>"+(has_desc&&typeof(this.spec.settings.desc[key])==="string"?this.spec.settings.desc[key]:"")+"</td>",$demoTd);$tbody.append($tr)}}$div.html($('<table class="table table-condensed table-bordered avi sortable"/>').append("<thead><tr><th>Feature</th><th>Setting</th><th>Description</th><th>Demo</th></tr></thead>",$tbody));$container.append($div);$select.append('<option value="'+this.name+'">'+this.name+"</option>");fn.sortSelect($select[0]);$select.find(">option:first").prop("selected",true);$select.change();this.applyGlobalHandlers($div)}return this},removeSettingsUI:function(){var $sel=$("#avi-module-settings-select");$sel.find('>[value=""]').remove();$("#module-settings-container").find(">div[data-module='']").remove();$sel.find(">option:first").prop("selected",true);$sel.change();return this},register:function(){if(!this.id||Object.keys(Module.prototype.loaded).indexOf(this.id)!==-1){console.error("Cannot load module "+this.name+": ID collision ("+this.id+")")}else{this.resolveDependencies();if(this.ok&&this.load){this.load($,this);this.createSettingsUI().applyGlobalHandlers();Module.prototype.loaded[this.id]=this;console.debug("Loaded module "+this.name)}else{console.error("Failed to load module "+this.name)}}return this},unregister:function(){this.removeSettingsUI();delete Module.prototype.loaded[this.id];console.debug("Module "+this.name+" unloaded");if(this.unload){this.unload($,this)}else{fn.notification("Module "+this.name+" unloaded. Due to this module's specifics you'll need to reload the page to see the effects.")}return this}};Module.prototype.applyGlobalHandlers();var exec_module=function(module){var mod=new Module(module);mod.register()};var required_modules=["activity-shortcuts","house-timers","market-tooltips","house-notifications"];var module_ajax_callback=function(r){eval(r)};for(var j=0;j<required_modules.length;j++){$.ajax(fn.gh_url("modules/"+required_modules[j]+".min.js"),{dataType:"text"}).done(module_ajax_callback)}})()})(jQuery,window.sessionStorage,MutationObserver,buzz,AloTimer,ConsoleLogHTML,console)}}},{"./modules":2,"./node_modules/collections/fast-set":4}],2:[function(b,c,a){c.exports={ACTIVITY_SHORTCUTS:{name:"Activity Shortcuts",desc:"Registers activity shortcuts on the side menu",id:"ACTIVITY_SHORTCUTS",dependencies:{fn:["gh_url","svg"]},vars:{appends:[["sword-clash","MobList","Open Battles"],["fishing","Fishing","Open Fishing"],["log","Woodcutting","Open Woodcutting"],["metal-bar","Mining","Open Mining"],["stone-block","#loadStonecutting","Open Stonecutting"]]},load:function(j,g){var l=g.spec.vars,h=j("<a href='javascript:;' class='avi-tip avi-menu-shortcut' style='border-bottom:none'/>"),k=j("#navWrapper").find("ul"),d;g.vars.li=j('<li class="avi-menu"/>');for(var f=0;f<l.appends.length;f++){d=h.clone().attr({"data-delegate-click":"#load"+l.appends[f][1],title:l.appends[f][2]});g.vars.li.append(d);g.dependencies.fn.svg(d,g.dependencies.fn.gh_url("res/svg/"+l.appends[f][0]+".svg"))}k.append(g.vars.li)},unload:function(f,d){d.vars.li.remove()}},HOUSE_NOTIFICATIONS:{name:"House notifications",desc:"Creates toast & sound notifications when house construction and/or Harvestron finish",id:"HOUSE_NOTIFICATIONS",dependencies:{fn:["parseTimeStringLong","gh_url","notification"],classes:["AloTimer","Interval","SFX"]},settings:{desc:{"Construction sound":"Play a sound when construction finishes","Construction toast":"Display a toast when construction finishes"},defaults:{"Construction sound":true,"Construction toast":true},demo:{"Construction sound":function(g,d,f){f.vars.sfx.play()},"Construction toast":function(g,d,f){f.dependencies.fn.notification("Construction finished",f.spec.name)}}},funcs:{click_house:function(){document.getElementById("header_house").click()},notify:function(d){if(!d.vars.notified){console.info("Construction finished");if(d.settings["Construction sound"]){d.vars.sfx.play()}if(d.settings["Construction toast"]){d.dependencies.fn.notification("Construction finished",d.spec.name,{onclick:d.spec.funcs.click_house})}}d.vars.notified=true}},load:function(i,g){function f(){i.ajax("/house.php",{global:false}).done(function(d){if(typeof(d.m)!=="undefined"){h(d.m)}})}function h(j){var k=new g.dependencies.classes.Interval(g.spec.name);k.clear();if(j.indexOf("available again")!==-1){var d=new g.dependencies.classes.AloTimer(g.dependencies.fn.parseTimeStringLong(j));k.set(function(){if(d.isFinished()){k.clear();g.spec.funcs.notify(g)}else{g.vars.notified=false}},1000)}else{if(j.indexOf("are available")!==-1){g.spec.funcs.notify(g)}else{setTimeout(f,1000)}}}g.vars={notified:false,house_requery:function(k,d,j){if(j.url.indexOf("house")!==-1&&typeof(d.responseJSON)!=="undefined"&&typeof(d.responseJSON.m)!=="undefined"){h(d.responseJSON.m)}},sfx:new g.dependencies.classes.SFX(g.dependencies.fn.gh_url("res/sfx/circ_saw.wav"))};i(document).ajaxComplete(g.vars.house_requery);f()},unload:function(d,f){d(document).unbind("ajaxComplete",f.vars.house_requery)}},HOUSE_TIMERS:{name:"House timers",desc:"Shows house construction timers without the need for an alarm clock",id:"HOUSE_TIMERS",dependencies:{fn:["parseTimeStringLong"],classes:["AloTimer","CssManager","Interval"]},load:function(j,k){var g=j("<div class='col-xs-6 col-md-12'/>");function l(){j.ajax("/house.php",{global:false}).done(function(d){if(typeof(d.m)!=="undefined"){i(d.m)}})}function h(d){d.clear();k.vars.paneSpan.addClass("avi-highlight").html(j('<span data-delegate-click="#header_house" style="cursor:pointer;text-decoration:underline;padding-right:5px">Ready!</span>')).append(j("<a href='javascript:;'>(refresh)</a>").click(l));k.applyGlobalHandlers(k.vars.paneSpan)}function i(f){var m=new k.dependencies.classes.Interval(k.spec.name);m.clear();if(f.indexOf("available again")!==-1){var d=new k.dependencies.classes.AloTimer(k.dependencies.fn.parseTimeStringLong(f));m.set(function(){if(d.isFinished()){h(m)}else{k.vars.paneSpan.removeClass("avi-highlight").text(d.toString())}},1000)}else{if(f.indexOf("are available")!==-1){h(m)}else{setTimeout(l,3000)}}}k.vars={paneLabel:g.clone().addClass("col-lg-5 gold").text("Construction:"),paneSpan:j("<span>House unavailable</span>"),house_requery:function(m,d,f){if(f.url.indexOf("house")!==-1&&typeof(d.responseJSON)!=="undefined"&&typeof(d.responseJSON.m)!=="undefined"){i(d.responseJSON.m)}},css:(new k.dependencies.classes.CssManager()).setRules({"#constructionNotifier,#houseTimerTable [data-typeid='Construction']":{display:"none !important"}}).addToDOM()};k.vars.paneSpanContainer=g.clone().addClass("col-lg-7").html(k.vars.paneSpan);j("#houseTimerInfo").addClass("avi-force-block");j("#houseTimerTable").prepend(k.vars.paneLabel,k.vars.paneSpanContainer);j(document).ajaxComplete(k.vars.house_requery);j.ajax("/house.php",{global:false}).done(function(d){if(typeof(d.m)!=="undefined"){i(d.m)}})},unload:function(d,f){f.vars.paneLabel.remove();f.vars.paneSpanContainer.remove();f.vars.css.removeFromDOM();d(document).unbind("ajaxComplete",f.vars.house_requery);d("#houseTimerInfo").removeClass("avi-force-block");(new f.dependencies.classes.Interval(f.spec.name)).clear()}},MARKET_TOOLTIPS:{name:"Market tooltips",desc:"Performs a market price lookup when you hover a supported item",id:"MARKET_TOOLTIPS",dependencies:{fn:["analysePrice","numberWithCommas","openMarket"],classes:["Request"]},vars:{CACHE_TTL:1/3600*60,html:'<table class="avi" style="margin:auto"><thead><tr><th colspan="3">Current market price (1st page)</th></tr><tr><th>Low</th><th>Average</th><th>High</th></tr></thead><tbody><tr data-id="prices"><td></td><td></td><td></td></tr></tbody></table>'},load:function(j,h){function l(o){var p=h.dependencies.fn.analysePrice(o.l);h.vars.dom.low_currency.text(h.dependencies.fn.numberWithCommas(p.low));h.vars.dom.avg_currency.text(h.dependencies.fn.numberWithCommas(p.avg));h.vars.dom.high_currency.text(h.dependencies.fn.numberWithCommas(p.high))}function d(){f.click();h.dependencies.fn.openMarket("Ingredients")}function n(){const p=j(this),o=p.text().trim();if(typeof(h.spec.vars.tradeskill_mats[o])==="undefined"){fn.notification("Failed to lookup "+o+": ID not found")}else{(new h.dependencies.classes.Request("/market.php",h.spec.vars.CACHE_TTL)).post({type:"ingredient",page:0,q:0,ll:0,hl:0,st:h.spec.vars.tradeskill_mats[o]}).done(function(s){const u=p.attr("aria-describedby"),q=j("#"+u);if(u&&q.length){const v=h.dependencies.fn.analysePrice(s.l),t=q.find("tr[data-id=prices]>td");t.first().text(h.dependencies.fn.numberWithCommas(v.low)).next().text(h.dependencies.fn.numberWithCommas(v.avg)).next().text(h.dependencies.fn.numberWithCommas(v.high))}})}}function m(){const q=j(this),p=q.text().trim(),o=j("<span>"+p+"</span>");q.html(o);o.popover({title:p,html:true,trigger:"hover",container:"body",viewport:{selector:"body",padding:0},placement:"auto right",content:j(h.spec.vars.html)});o.mouseenter(n).css("cursor","pointer").click(d)}var k=j("#currencyTooltipMarketable"),g=j("#currencyTooltip"),f=j("#modalBackground"),i;h.vars={dom:{},clickies:j("#allThemTables").find(".currencyWithTooltip:not(:contains(Gold))"),click:{currency:function(){const o=j(this).find(">td:first").text().trim();h.dependencies.fn.openMarket(o.substring(0,o.length-1))}},observers:{currency_tooltips:new MutationObserver(function(p){if(p.length&&k.is(":visible")){const o=k.attr("class"),q=o.replace("crystals","premium").replace("materials","weapon_scraps").replace("fragments","gem_fragments");h.vars.dom.row_currency.attr("class",o);if(o==="gold"){i.text("N/A")}else{i.text(" ");(new h.dependencies.classes.Request("/market.php",h.spec.vars.CACHE_TTL)).post({type:"currency",page:0,st:q}).done(l)}}}),inventory_table:new MutationObserver(function(p){for(var q=0;q<p.length;q++){if(p[q].addedNodes.length){for(var r=0;r<p[q].addedNodes.length;r++){if(p[q].addedNodes[r] instanceof HTMLTableSectionElement){const o=j(p[q].addedNodes[r]);if(o.find("th:contains(Ingredient)").length){o.find(">tr>[data-th=Item]").each(m)}break}}break}}})}};h.vars.clickies.css("cursor","pointer").click(h.vars.click.currency);h.vars.dom.table_currency=j(h.spec.vars.html);h.vars.dom.row_currency=h.vars.dom.table_currency.find("tr[data-id=prices]");i=h.vars.dom.row_currency.find(">td");h.vars.dom.low_currency=i.first();h.vars.dom.avg_currency=h.vars.dom.low_currency.next();h.vars.dom.high_currency=h.vars.dom.avg_currency.next();g.append(h.vars.dom.table_currency);h.vars.observers.currency_tooltips.observe(g[0],{attributes:true});h.vars.observers.inventory_table.observe(document.querySelector("#inventoryTable"),{attributes:true,childList:true,characterData:true})},unload:function(h,g){g.vars.clickies.css("cursor","initial").unbind("click",g.vars.click.currency);if(typeof(g.vars.dom)!=="undefined"){for(var f in g.vars.dom){if(g.vars.dom.hasOwnProperty(f)){g.vars.dom[f].remove();delete g.vars.dom[f]}}}if(typeof(g.vars.observers)!=="undefined"){for(var d in g.vars.observers){if(g.vars.observers.hasOwnProperty(d)){g.vars.observers[d].disconnect()}}}}}}},{}],3:[function(b,d,a){var h=b("./shim");var c=b("./generic-collection");var i=b("./generic-map");var g=b("./listen/property-changes");d.exports=f;function f(j,k){if(!(this instanceof f)){return new f(j,k)}k=k||Function.noop;this.getDefault=k;this.store=Object.create(null);this.length=0;this.addEach(j)}f.Dict=f;Object.addEach(f.prototype,c.prototype);Object.addEach(f.prototype,i.prototype);Object.addEach(f.prototype,g.prototype);f.prototype.constructClone=function(j){return new this.constructor(j,this.getDefault)};f.prototype.assertString=function(j){if(typeof j!=="string"){throw new TypeError("key must be a string but Got "+j)}};Object.defineProperty(f.prototype,"$__proto__",{writable:true});Object.defineProperty(f.prototype,"_hasProto",{get:function(){return this.hasOwnProperty("$__proto__")&&typeof this._protoValue!=="undefined"}});Object.defineProperty(f.prototype,"_protoValue",{get:function(){return this["$__proto__"]},set:function(j){this["$__proto__"]=j}});f.prototype.get=function(k,j){this.assertString(k);if(k==="__proto__"){if(this._hasProto){return this._protoValue}else{if(arguments.length>1){return j}else{return this.getDefault(k)}}}else{if(k in this.store){return this.store[k]}else{if(arguments.length>1){return j}else{return this.getDefault(k)}}}};f.prototype.set=function(k,l){this.assertString(k);var j=(k==="__proto__");if(j?this._hasProto:k in this.store){if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(k,j?this._protoValue:this.store[k])}j?this._protoValue=l:this.store[k]=l;if(this.dispatchesMapChanges){this.dispatchMapChange(k,l)}return false}else{if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(k,undefined)}this.length++;j?this._protoValue=l:this.store[k]=l;if(this.dispatchesMapChanges){this.dispatchMapChange(k,l)}return true}};f.prototype.has=function(j){this.assertString(j);return j==="__proto__"?this._hasProto:j in this.store};f.prototype["delete"]=function(j){this.assertString(j);if(j==="__proto__"){if(this._hasProto){if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(j,this._protoValue)}this._protoValue=undefined;this.length--;if(this.dispatchesMapChanges){this.dispatchMapChange(j,undefined)}return true}return false}else{if(j in this.store){if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(j,this.store[j])}delete this.store[j];this.length--;if(this.dispatchesMapChanges){this.dispatchMapChange(j,undefined)}return true}return false}};f.prototype.clear=function(){var j;if(this._hasProto){if(this.dispatchesMapChanges){this.dispatchBeforeMapChange("__proto__",this._protoValue)}this._protoValue=undefined;if(this.dispatchesMapChanges){this.dispatchMapChange("__proto__",undefined)}}for(j in this.store){if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(j,this.store[j])}delete this.store[j];if(this.dispatchesMapChanges){this.dispatchMapChange(j,undefined)}}this.length=0};f.prototype.reduce=function(n,m,l){if(this._hasProto){m=n.call(l,m,"$__proto__","__proto__",this)}var j=this.store;for(var k in this.store){m=n.call(l,m,j[k],k,this)}return m};f.prototype.reduceRight=function(n,m,l){var k=this;var j=this.store;m=Object.keys(this.store).reduceRight(function(p,o){return n.call(l,p,j[o],o,k)},m);if(this._hasProto){return n.call(l,m,this._protoValue,"__proto__",k)}return m};f.prototype.one=function(){var j;for(j in this.store){return this.store[j]}return this._protoValue};f.prototype.toJSON=function(){return this.toObject()}},{"./generic-collection":5,"./generic-map":6,"./listen/property-changes":11,"./shim":17}],4:[function(d,b,g){var j=d("./shim");var i=d("./dict");var m=d("./list");var h=d("./generic-collection");var l=d("./generic-set");var k=d("./tree-log");var c=d("./listen/property-changes");var a=Object.prototype.hasOwnProperty;b.exports=f;function f(p,r,s,q){if(!(this instanceof f)){return new f(p,r,s,q)}r=r||Object.equals;s=s||Object.hash;q=q||Function.noop;this.contentEquals=r;this.contentHash=s;this.getDefault=q;var o=this;this.buckets=new this.Buckets(null,function n(){return new o.Bucket()});this.length=0;this.addEach(p)}f.FastSet=f;Object.addEach(f.prototype,h.prototype);Object.addEach(f.prototype,l.prototype);Object.addEach(f.prototype,c.prototype);f.prototype.Buckets=i;f.prototype.Bucket=m;f.prototype.constructClone=function(n){return new this.constructor(n,this.contentEquals,this.contentHash,this.getDefault)};f.prototype.has=function(n){var o=this.contentHash(n);return this.buckets.get(o).has(n)};f.prototype.get=function(p,o){if(o){throw new Error("FastSet#get does not support second argument: equals")}var q=this.contentHash(p);var n=this.buckets;if(n.has(q)){return n.get(q).get(p)}else{return this.getDefault(p)}};f.prototype["delete"]=function(p,o){if(o){throw new Error("FastSet#delete does not support second argument: equals")}var q=this.contentHash(p);var n=this.buckets;if(n.has(q)){var r=n.get(q);if(r["delete"](p)){this.length--;if(r.length===0){n["delete"](q)}return true}}return false};f.prototype.clear=function(){this.buckets.clear();this.length=0};f.prototype.add=function(o){var p=this.contentHash(o);var n=this.buckets;if(!n.has(p)){n.set(p,new this.Bucket(null,this.contentEquals))}if(!n.get(p).has(o)){n.get(p).add(o);this.length++;return true}return false};f.prototype.reduce=function(r,q){var o=arguments[2];var p=this.buckets;var n=0;return p.reduce(function(s,t){return t.reduce(function(v,u){return r.call(o,v,u,n++,this)},s,this)},q,this)};f.prototype.one=function(){if(this.length>0){return this.buckets.one().one()}};f.prototype.iterate=function(){return this.buckets.values().flatten().iterate()};f.prototype.log=function(r,p,s,o){r=r||k.unicodeSharp;p=p||this.logNode;if(!s){s=console.log;o=console}s=s.bind(o);var q=this.buckets;var n=q.keys();n.forEach(function(w,t){var u;var v;if(t===n.length-1){u=r.fromAbove;v=" "}else{if(t===0){u=r.branchDown;v=r.strafe}else{u=r.fromBoth;v=r.strafe}}var x=q.get(w);s.call(o,u+r.through+r.branchDown+" "+w);x.forEach(function(B,A){var z,C;if(A===x.head.prev){z=r.fromAbove;C=" "}else{z=r.fromBoth;C=r.strafe}var y;p(A,function(D){if(!y){s.call(o,v+" "+z+r.through+r.through+D);y=true}else{s.call(o,v+" "+C+"  "+D)}},function(D){s.call(o,v+" "+r.strafe+"  "+D)})})})};f.prototype.logNode=function(o,n){var p=o.value;if(Object(p)===p){JSON.stringify(p,null,4).split("\n").forEach(function(q){n(" "+q)})}else{n(" "+p)}}},{"./dict":3,"./generic-collection":5,"./generic-set":8,"./list":9,"./listen/property-changes":11,"./shim":17,"./tree-log":18}],5:[function(b,d,a){d.exports=c;function c(){throw new Error("Can't construct. GenericCollection is a mixin.")}c.EmptyArray=Object.freeze([]);c.prototype.addEach=function(f){if(f&&Object(f)===f){if(typeof f.forEach==="function"){f.forEach(this.add,this)}else{if(typeof f.length==="number"){for(var g=0;g<f.length;g++){this.add(f[g],g)}}else{Object.keys(f).forEach(function(h){this.add(f[h],h)},this)}}}else{if(f&&typeof f.length==="number"){for(var g=0;g<f.length;g++){this.add(f[g],g)}}}return this};c.prototype.deleteEach=function(f,g){f.forEach(function(h){this["delete"](h,g)},this);return this};c.prototype.forEach=function(g){var f=arguments[1];return this.reduce(function(l,j,i,h,k){g.call(f,j,i,h,k)},undefined)};c.prototype.map=function(h){var g=arguments[1];var f=[];this.reduce(function(m,k,j,i,l){f.push(h.call(g,k,j,i,l))},undefined);return f};c.prototype.enumerate=function(g){if(g==null){g=0}var f=[];this.reduce(function(i,h){f.push([g++,h])},undefined);return f};c.prototype.group=function(j,g,i){i=i||Object.equals;var f=[];var h=[];this.forEach(function(n,m,l){var m=j.call(g,n,m,l);var k=h.indexOf(m,i);var o;if(k===-1){o=[];f.push([m,o]);h.push(m)}else{o=f[k][1]}o.push(n)});return f};c.prototype.toArray=function(){return this.map(Function.identity)};c.prototype.toObject=function(){var f={};this.reduce(function(i,h,g){f[g]=h},undefined);return f};c.prototype.filter=function(h){var g=arguments[1];var f=this.constructClone();this.reduce(function(m,k,j,i,l){if(h.call(g,k,j,i,l)){f.add(k,j)}},undefined);return f};c.prototype.every=function(g){var f=arguments[1];return this.reduce(function(h,k,j,i,l){return h&&g.call(f,k,j,i,l)},true)};c.prototype.some=function(g){var f=arguments[1];return this.reduce(function(h,k,j,i,l){return h||g.call(f,k,j,i,l)},false)};c.prototype.all=function(){return this.every(Boolean)};c.prototype.any=function(){return this.some(Boolean)};c.prototype.min=function(f){f=f||this.contentCompare||Object.compare;var g=true;return this.reduce(function(h,i){if(g){g=false;return i}else{return f(i,h)<0?i:h}},undefined)};c.prototype.max=function(f){f=f||this.contentCompare||Object.compare;var g=true;return this.reduce(function(h,i){if(g){g=false;return i}else{return f(i,h)>0?i:h}},undefined)};c.prototype.sum=function(f){f=f===undefined?0:f;return this.reduce(function(h,g){return h+g},f)};c.prototype.average=function(h){var f=h===undefined?0:h;var g=h===undefined?0:h;this.reduce(function(j,i){f+=i;g+=1},undefined);return f/g};c.prototype.concat=function(){var f=this.constructClone(this);for(var g=0;g<arguments.length;g++){f.addEach(arguments[g])}return f};c.prototype.flatten=function(){var f=this;return this.reduce(function(g,h){h.forEach(function(i){this.push(i)},g,f);return g},[])};c.prototype.zip=function(){var f=Array.prototype.slice.call(arguments);f.unshift(this);return Array.unzip(f)};c.prototype.join=function(f){return this.reduce(function(g,h){if(g===void 0){return h}else{return g+f+h}},void 0)};c.prototype.sorted=function(g,h,f){g=g||this.contentCompare||Object.compare;if(g.by){h=g.by;g=g.compare||this.contentCompare||Object.compare}else{h=h||Function.identity}if(f===undefined){f=1}return this.map(function(i){return{by:h(i),value:i}}).sort(function(j,i){return g(j.by,i.by)*f}).map(function(i){return i.value})};c.prototype.reversed=function(){return this.constructClone(this).reverse()};c.prototype.clone=function(g,f){if(g===undefined){g=Infinity}else{if(g===0){return this}}var h=this.constructClone();this.forEach(function(j,i){h.add(Object.clone(j,g-1,f),i)},this);return h};c.prototype.only=function(){if(this.length===1){return this.one()}};c.prototype.iterator=function(){return this.iterate.apply(this,arguments)};c._sizePropertyDescriptor={get:function(){return this.length},enumerable:false,configurable:true};Object.defineProperty(c.prototype,"size",c._sizePropertyDescriptor);b("./shim-array")},{"./shim-array":13}],6:[function(f,g,c){var b=f("./shim-object");var a=f("./listen/map-changes");var h=f("./listen/property-changes");g.exports=i;function i(){throw new Error("Can't construct. GenericMap is a mixin.")}b.addEach(i.prototype,a.prototype);b.addEach(i.prototype,h.prototype);i.prototype.isMap=true;i.prototype.addEach=function(j){if(j&&b(j)===j){if(typeof j.forEach==="function"){if(j.isMap===true){j.forEach(function(m,l){this.set(l,m)},this)}else{j.forEach(function(l){this.set(l[0],l[1])},this)}}else{if(typeof j.length==="number"){for(var k=0;k<j.length;k++){this.add(j[k],k)}}else{b.keys(j).forEach(function(l){this.set(l,j[l])},this)}}}else{if(j&&typeof j.length==="number"){for(var k=0;k<j.length;k++){this.add(j[k],k)}}}return this};i.prototype.get=function(k,j){var l=this.store.get(new this.Item(k));if(l){return l.value}else{if(arguments.length>1){return j}else{return this.getDefault(k)}}};i.prototype.set=function(j,m){var k=new this.Item(j,m);var l=this.store.get(k);var n=false;if(l){if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(j,l.value)}l.value=m;if(this.dispatchesMapChanges){this.dispatchMapChange(j,m)}}else{if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(j,undefined)}if(this.store.add(k)){this.length++;n=true}if(this.dispatchesMapChanges){this.dispatchMapChange(j,m)}}return n};i.prototype.add=function(k,j){return this.set(j,k)};i.prototype.has=function(j){return this.store.has(new this.Item(j))};i.prototype["delete"]=function(j){var k=new this.Item(j);if(this.store.has(k)){var l=this.store.get(k).value;if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(j,l)}this.store["delete"](k);this.length--;if(this.dispatchesMapChanges){this.dispatchMapChange(j,undefined)}return true}return false};i.prototype.clear=function(){var j;if(this.dispatchesMapChanges){this.forEach(function(l,k){this.dispatchBeforeMapChange(k,l)},this);j=this.keys()}this.store.clear();this.length=0;if(this.dispatchesMapChanges){j.forEach(function(k){this.dispatchMapChange(k)},this)}};i.prototype.reduce=function(l,k,j){return this.store.reduce(function(n,m){return l.call(j,n,m.value,m.key,this)},k,this)};i.prototype.reduceRight=function(l,k,j){return this.store.reduceRight(function(n,m){return l.call(j,n,m.value,m.key,this)},k,this)};i.prototype.keys=function(){return this.map(function(k,j){return j})};i.prototype.values=function(){return this.map(Function.identity)};i.prototype.entries=function(){return this.map(function(k,j){return[j,k]})};i.prototype.items=function(){return this.entries()};i.prototype.equals=function(l,k){k=k||b.equals;if(this===l){return true}else{if(l&&typeof l.every==="function"){return l.length===this.length&&l.every(function(n,m){return k(this.get(m),n)},this)}else{var j=b.keys(l);return j.length===this.length&&b.keys(l).every(function(m){return k(this.get(m),l[m])},this)}}};i.prototype.toJSON=function(){return this.entries()};i.prototype.Item=d;function d(j,k){this.key=j;this.value=k}d.prototype.equals=function(j){return b.equals(this.key,j.key)&&b.equals(this.value,j.value)};d.prototype.compare=function(j){return b.compare(this.key,j.key)}},{"./listen/map-changes":10,"./listen/property-changes":11,"./shim-object":15}],7:[function(c,d,b){var a=c("./shim-object");d.exports=f;function f(){throw new Error("Can't construct. GenericOrder is a mixin.")}f.prototype.equals=function(i,h){h=h||this.contentEquals||a.equals;if(this===i){return true}if(!i){return false}var g=this;return(this.length===i.length&&this.zip(i).every(function(j){return h(j[0],j[1])}))};f.prototype.compare=function(h,j){j=j||this.contentCompare||a.compare;if(this===h){return 0}if(!h){return 1}var g=Math.min(this.length,h.length);var i=this.zip(h).reduce(function(l,m,k){if(l===0){if(k>=g){return l}else{return j(m[0],m[1])}}else{return l}},0);if(i===0){return this.length-h.length}return i};f.prototype.toJSON=function(){return this.toArray()}},{"./shim-object":15}],8:[function(b,c,a){c.exports=d;function d(){throw new Error("Can't construct. GenericSet is a mixin.")}d.prototype.isSet=true;d.prototype.union=function(f){var g=this.constructClone(this);g.addEach(f);return g};d.prototype.intersection=function(f){return this.constructClone(this.filter(function(g){return f.has(g)}))};d.prototype.difference=function(f){var g=this.constructClone(this);g.deleteEach(f);return g};d.prototype.symmetricDifference=function(f){var g=this.union(f);var h=this.intersection(f);return g.difference(h)};d.prototype.deleteAll=function(f){return +this["delete"](f)};d.prototype.equals=function(h,g){var f=this;return(h&&typeof h.reduce==="function"&&this.length===h.length&&h.reduce(function(i,j){return i&&f.has(j,g)},true))};d.prototype.toJSON=function(){return this.toArray()};d.prototype.contains=function(f){return this.has(f)};d.prototype.remove=function(f){return this["delete"](f)};d.prototype.toggle=function(f){if(this.has(f)){this["delete"](f)}else{this.add(f)}}},{}],9:[function(d,b,g){b.exports=l;var k=d("./shim");var h=d("./generic-collection");var a=d("./generic-order");var c=d("./listen/property-changes");var f=d("./listen/range-changes");function l(m,p,o){if(!(this instanceof l)){return new l(m,p,o)}var n=this.head=new this.Node();n.next=n;n.prev=n;this.contentEquals=p||Object.equals;this.getDefault=o||Function.noop;this.length=0;this.addEach(m)}l.List=l;Object.addEach(l.prototype,h.prototype);Object.addEach(l.prototype,a.prototype);Object.addEach(l.prototype,c.prototype);Object.addEach(l.prototype,f.prototype);l.prototype.constructClone=function(m){return new this.constructor(m,this.contentEquals,this.getDefault)};l.prototype.find=function(q,p,n){p=p||this.contentEquals;var o=this.head;var m=this.scan(n,o.next);while(m!==o){if(p(m.value,q)){return m}m=m.next}};l.prototype.findLast=function(q,p,n){p=p||this.contentEquals;var o=this.head;var m=this.scan(n,o.prev);while(m!==o){if(p(m.value,q)){return m}m=m.prev}};l.prototype.has=function(n,m){return !!this.find(n,m)};l.prototype.get=function(o,m){var n=this.find(o,m);if(n){return n.value}return this.getDefault(o)};l.prototype["delete"]=function(p,n){var o=this.findLast(p,n);if(o){if(this.dispatchesRangeChanges){var q=[];var m=[p];this.dispatchBeforeRangeChange(q,m,o.index)}o["delete"]();this.length--;if(this.dispatchesRangeChanges){this.updateIndexes(o.next,o.index);this.dispatchRangeChange(q,m,o.index)}return true}return false};l.prototype.deleteAll=function(q,p){p=p||this.contentEquals;var n=this.head;var m=n.next;var o=0;while(m!==n){if(p(q,m.value)){m["delete"]();o++}m=m.next}this.length-=o;return o};l.prototype.clear=function(){var n,m;if(this.dispatchesRangeChanges){m=this.toArray();n=[];this.dispatchBeforeRangeChange(n,m,0)}this.head.next=this.head.prev=this.head;this.length=0;if(this.dispatchesRangeChanges){this.dispatchRangeChange(n,m,0)}};l.prototype.add=function(n){var m=new this.Node(n);if(this.dispatchesRangeChanges){m.index=this.length;this.dispatchBeforeRangeChange([n],[],m.index)}this.head.addBefore(m);this.length++;if(this.dispatchesRangeChanges){this.dispatchRangeChange([n],[],m.index)}return true};l.prototype.push=function(){var o=this.head;if(this.dispatchesRangeChanges){var t=Array.prototype.slice.call(arguments);var q=[];var m=this.length;this.dispatchBeforeRangeChange(t,q,m);var s=this.head.prev}for(var n=0;n<arguments.length;n++){var r=arguments[n];var p=new this.Node(r);o.addBefore(p)}this.length+=arguments.length;if(this.dispatchesRangeChanges){this.updateIndexes(s.next,s.index===undefined?0:s.index+1);this.dispatchRangeChange(t,q,m)}};l.prototype.unshift=function(){if(this.dispatchesRangeChanges){var r=Array.prototype.slice.call(arguments);var p=[];this.dispatchBeforeRangeChange(r,p,0)}var m=this.head;for(var n=0;n<arguments.length;n++){var q=arguments[n];var o=new this.Node(q);m.addAfter(o);m=o}this.length+=arguments.length;if(this.dispatchesRangeChanges){this.updateIndexes(this.head.next,0);this.dispatchRangeChange(r,p,0)}};l.prototype.pop=function(){var p;var n=this.head;if(n.prev!==n){p=n.prev.value;if(this.dispatchesRangeChanges){var q=[];var o=[p];var m=this.length-1;this.dispatchBeforeRangeChange(q,o,m)}n.prev["delete"]();this.length--;if(this.dispatchesRangeChanges){this.dispatchRangeChange(q,o,m)}}return p};l.prototype.shift=function(){var o;var m=this.head;if(m.prev!==m){o=m.next.value;if(this.dispatchesRangeChanges){var p=[];var n=[o];this.dispatchBeforeRangeChange(p,n,0)}m.next["delete"]();this.length--;if(this.dispatchesRangeChanges){this.updateIndexes(this.head.next,0);this.dispatchRangeChange(p,n,0)}}return o};l.prototype.peek=function(){if(this.head!==this.head.next){return this.head.next.value}};l.prototype.poke=function(m){if(this.head!==this.head.next){this.head.next.value=m}else{this.push(m)}};l.prototype.one=function(){return this.peek()};l.prototype.scan=function(m,p){var n=this.head;if(typeof m==="number"){var o=m;if(o>=0){m=n.next;while(o){o--;m=m.next;if(m==n){break}}}else{m=n;while(o<0){o++;m=m.prev;if(m==n){break}}}return m}else{return m||p}};l.prototype.slice=function(m,n){var o=[];var p=this.head;m=this.scan(m,p.next);n=this.scan(n,p);while(m!==n&&m!==p){o.push(m.value);m=m.next}return o};l.prototype.splice=function(m,n){return this.swap(m,n,Array.prototype.slice.call(arguments,2))};l.prototype.swap=function(m,n,t){var v=m;m=this.scan(m,this.head);if(n==null){n=Infinity}t=Array.from(t);var r=[];var p=m;while(n--&&n>=0&&p!==this.head){r.push(p.value);p=p.next}var u,o;if(this.dispatchesRangeChanges){if(m===this.head){u=this.length}else{if(m.prev===this.head){u=0}else{u=m.index}}o=m.prev;this.dispatchBeforeRangeChange(t,r,u)}var p=m;for(var s=0,p=m;s<r.length;s++,p=p.next){p["delete"]()}if(v==null&&p===this.head){p=this.head.next}for(var s=0;s<t.length;s++){var q=new this.Node(t[s]);p.addBefore(q)}this.length+=t.length-r.length;if(this.dispatchesRangeChanges){if(m===this.head){this.updateIndexes(this.head.next,0)}else{this.updateIndexes(o.next,o.index+1)}this.dispatchRangeChange(t,r,u)}return r};l.prototype.reverse=function(){if(this.dispatchesRangeChanges){var o=this.toArray();var p=o.reversed();this.dispatchBeforeRangeChange(p,o,0)}var m=this.head;do{var n=m.next;m.next=m.prev;m.prev=n;m=m.next}while(m!==this.head);if(this.dispatchesRangeChanges){this.dispatchRangeChange(p,o,0)}return this};l.prototype.sort=function(){this.swap(0,this.length,this.sorted())};l.prototype.reduce=function(q,p){var o=arguments[2];var n=this.head;var m=n.next;while(m!==n){p=q.call(o,p,m.value,m,this);m=m.next}return p};l.prototype.reduceRight=function(q,p){var o=arguments[2];var n=this.head;var m=n.prev;while(m!==n){p=q.call(o,p,m.value,m,this);m=m.prev}return p};l.prototype.updateIndexes=function(n,m){while(n!==this.head){n.index=m++;n=n.next}};l.prototype.makeObservable=function(){this.head.index=-1;this.updateIndexes(this.head.next,0);this.dispatchesRangeChanges=true};l.prototype.iterate=function(){return new i(this.head)};function i(m){this.head=m;this.at=m.next}i.prototype.__iterationObject=null;Object.defineProperty(i.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:false,value:null})}});i.prototype.next=function(){if(this.at===this.head){this._iterationObject.done=true;this._iterationObject.value=void 0}else{var m=this.at.value;this.at=this.at.next;this._iterationObject.value=m}return this._iterationObject};l.prototype.Node=j;function j(m){this.value=m;this.prev=null;this.next=null}j.prototype["delete"]=function(){this.prev.next=this.next;this.next.prev=this.prev};j.prototype.addBefore=function(n){var m=this.prev;this.prev=n;n.prev=m;m.next=n;n.next=this};j.prototype.addAfter=function(n){var m=this.next;this.next=n;n.next=m;m.prev=n;n.prev=this}},{"./generic-collection":5,"./generic-order":7,"./listen/property-changes":11,"./listen/range-changes":12,"./shim":17}],10:[function(b,a,c){var j=b("weak-map");var i=b("../list");a.exports=h;function h(){throw new Error("Can't construct. MapChanges is a mixin.")}var g=Object.prototype.hasOwnProperty;var d=new j();var f=null;h.prototype.getAllMapChangeDescriptors=function(){if(!d.has(this)){if(!f){f=b("../dict")}d.set(this,f())}return d.get(this)};h.prototype.getMapChangeDescriptor=function(l){var k=this.getAllMapChangeDescriptors();l=l||"";if(!k.has(l)){k.set(l,{willChangeListeners:new i(),changeListeners:new i()})}return k.get(l)};h.prototype.addMapChangeListener=function(p,l,o){if(!this.isObservable&&this.makeObservable){this.makeObservable()}var q=this.getMapChangeDescriptor(l);var n;if(o){n=q.willChangeListeners}else{n=q.changeListeners}n.push(p);Object.defineProperty(this,"dispatchesMapChanges",{value:true,writable:true,configurable:true,enumerable:false});var k=this;return function m(){if(!k){return}k.removeMapChangeListener(p,l,o);k=null}};h.prototype.removeMapChangeListener=function(o,k,n){var p=this.getMapChangeDescriptor(k);var l;if(n){l=p.willChangeListeners}else{l=p.changeListeners}var m=l.findLast(o);if(!m){throw new Error("Can't remove map change listener: does not exist: token "+JSON.stringify(k))}m["delete"]()};h.prototype.dispatchMapChange=function(k,n,m){var l=this.getAllMapChangeDescriptors();var o="Map"+(m?"WillChange":"Change");l.forEach(function(s,p){if(s.isActive){return}else{s.isActive=true}var q;if(m){q=s.willChangeListeners}else{q=s.changeListeners}var r="handle"+(p.slice(0,1).toUpperCase()+p.slice(1))+o;try{q.forEach(function(t){if(t[r]){t[r](n,k,this)}else{if(t.call){t.call(t,n,k,this)}else{throw new Error("Handler "+t+" has no method "+r+" and is not callable")}}},this)}finally{s.isActive=false}},this)};h.prototype.addBeforeMapChangeListener=function(l,k){return this.addMapChangeListener(l,k,true)};h.prototype.removeBeforeMapChangeListener=function(l,k){return this.removeMapChangeListener(l,k,true)};h.prototype.dispatchBeforeMapChange=function(k,l){return this.dispatchMapChange(k,l,true)}},{"../dict":3,"../list":9,"weak-map":19}],11:[function(b,c,a){b("../shim");var g=Object.prototype.hasOwnProperty;c.exports=f;function f(){throw new Error("This is an abstract interface. Mix it. Don't construct it")}f.debug=true;f.prototype.getOwnPropertyChangeDescriptor=function(j){if(!this.__propertyChangeListeners__){Object.defineProperty(this,"__propertyChangeListeners__",{value:{},enumerable:false,configurable:true,writable:true})}var i=this.__propertyChangeListeners__;if(!g.call(i,j)){var h=String(j);h=h&&h[0].toUpperCase()+h.slice(1);i[j]={willChangeListeners:{current:[],active:[],specificHandlerMethodName:"handle"+h+"WillChange",genericHandlerMethodName:"handlePropertyWillChange"},changeListeners:{current:[],active:[],specificHandlerMethodName:"handle"+h+"Change",genericHandlerMethodName:"handlePropertyChange"}}}return i[j]};f.prototype.hasOwnPropertyChangeDescriptor=function(i){if(!this.__propertyChangeListeners__){return false}if(!i){return true}var h=this.__propertyChangeListeners__;if(!g.call(h,i)){return false}return true};f.prototype.addOwnPropertyChangeListener=function(i,m,l){if(this.makeObservable&&!this.isObservable){this.makeObservable()}var n=f.getOwnPropertyChangeDescriptor(this,i);var j;if(l){j=n.willChangeListeners}else{j=n.changeListeners}f.makePropertyObservable(this,i);j.current.push(m);var h=this;return function k(){f.removeOwnPropertyChangeListener(h,i,m,l);h=null}};f.prototype.addBeforeOwnPropertyChangeListener=function(h,i){return f.addOwnPropertyChangeListener(this,h,i,true)};f.prototype.removeOwnPropertyChangeListener=function(i,l,k){var m=f.getOwnPropertyChangeDescriptor(this,i);var j;if(k){j=m.willChangeListeners}else{j=m.changeListeners}var h=j.current.lastIndexOf(l);if(h===-1){throw new Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(i))}j.current.splice(h,1)};f.prototype.removeBeforeOwnPropertyChangeListener=function(h,i){return f.removeOwnPropertyChangeListener(this,h,i,true)};f.prototype.dispatchOwnPropertyChange=function(h,k,j){var l=f.getOwnPropertyChangeDescriptor(this,h),i;if(!l.isActive){l.isActive=true;if(j){i=l.willChangeListeners}else{i=l.changeListeners}try{d(i,h,k,this)}finally{l.isActive=false}}};function d(p,s,r,l){var k=p.active;var o=p.current;var n=o.length;var j,h=n,m,q;if(k.length>n){k.length=n}while(n--){k[n]=o[n]}for(m=0;m<h;m++){q=k[m];if(!m||o.indexOf(q)>=0){j=(q[p.specificHandlerMethodName]||q[p.genericHandlerMethodName]||q);if(!j.call){throw new Error("No event listener for "+p.specificHandlerName+" or "+p.genericHandlerName+" or call on "+j)}j.call(q,r,s,l)}}}f.prototype.dispatchBeforeOwnPropertyChange=function(h,i){return f.dispatchOwnPropertyChange(this,h,i,true)};f.prototype.makePropertyObservable=function(i){var h=this.__overriddenPropertyDescriptors__;if(!h){if(Array.isArray(this)){return}if(!Object.isExtensible(this)){throw new Error("Can't make property "+JSON.stringify(i)+" observable on "+this+" because object is not extensible")}h={};Object.defineProperty(this,"__overriddenPropertyDescriptors__",{value:h,enumerable:false,writable:true,configurable:true})}else{if(g.call(h,i)){return}}var m;if(typeof this.__state__==="object"){m=this.__state__}else{m={};Object.defineProperty(this,"__state__",{value:m,writable:true,enumerable:false})}m[i]=this[i];var l;var j=this;do{l=Object.getOwnPropertyDescriptor(j,i);if(l){break}j=Object.getPrototypeOf(j)}while(j);if(!l){l={value:undefined,enumerable:true,writable:true,configurable:true}}else{if(!l.configurable){return}if(!l.writable&&!l.set){return}}h[i]=l;var k;if("value" in l){k={get:function(){return l.value},set:function(o){var p,n;if(o!==l.value){p=this.__propertyChangeListeners__[i];n=p.isActive;if(!n){p.isActive=true;try{d(p.willChangeListeners,i,l.value,this)}finally{}}l.value=o;m[i]=o;if(!n){try{d(p.changeListeners,i,o,this)}finally{p.isActive=false}}}},enumerable:l.enumerable,configurable:true}}else{k={get:l.get,set:function(p){var n=this[i],q,o;l.set.call(this,p);p=this[i];if(p!==n){q=this.__propertyChangeListeners__[i];o=q.isActive;if(!o){q.isActive=true;try{d(q.willChangeListeners,i,n,this)}finally{}}m[i]=p;if(!o){try{d(q.changeListeners,i,p,this)}finally{q.isActive=false}}}},enumerable:l.enumerable,configurable:true}}Object.defineProperty(this,i,k)};f.getOwnPropertyChangeDescriptor=function(h,i){if(h.getOwnPropertyChangeDescriptor){return h.getOwnPropertyChangeDescriptor(i)}else{return f.prototype.getOwnPropertyChangeDescriptor.call(h,i)}};f.hasOwnPropertyChangeDescriptor=function(h,i){if(h.hasOwnPropertyChangeDescriptor){return h.hasOwnPropertyChangeDescriptor(i)}else{return f.prototype.hasOwnPropertyChangeDescriptor.call(h,i)}};f.addOwnPropertyChangeListener=function(h,i,k,j){if(!Object.isObject(h)){}else{if(h.addOwnPropertyChangeListener){return h.addOwnPropertyChangeListener(i,k,j)}else{return f.prototype.addOwnPropertyChangeListener.call(h,i,k,j)}}};f.removeOwnPropertyChangeListener=function(h,i,k,j){if(!Object.isObject(h)){}else{if(h.removeOwnPropertyChangeListener){return h.removeOwnPropertyChangeListener(i,k,j)}else{return f.prototype.removeOwnPropertyChangeListener.call(h,i,k,j)}}};f.dispatchOwnPropertyChange=function(h,i,k,j){if(!Object.isObject(h)){}else{if(h.dispatchOwnPropertyChange){return h.dispatchOwnPropertyChange(i,k,j)}else{return f.prototype.dispatchOwnPropertyChange.call(h,i,k,j)}}};f.addBeforeOwnPropertyChangeListener=function(h,i,j){return f.addOwnPropertyChangeListener(h,i,j,true)};f.removeBeforeOwnPropertyChangeListener=function(h,i,j){return f.removeOwnPropertyChangeListener(h,i,j,true)};f.dispatchBeforeOwnPropertyChange=function(h,i,j){return f.dispatchOwnPropertyChange(h,i,j,true)};f.makePropertyObservable=function(h,i){if(h.makePropertyObservable){return h.makePropertyObservable(i)}else{return f.prototype.makePropertyObservable.call(h,i)}}},{"../shim":17}],12:[function(c,d,b){var f=c("weak-map");var h=c("../dict");var a=new f();d.exports=g;function g(){throw new Error("Can't construct. RangeChanges is a mixin.")}g.prototype.getAllRangeChangeDescriptors=function(){if(!a.has(this)){a.set(this,h())}return a.get(this)};g.prototype.getRangeChangeDescriptor=function(j){var i=this.getAllRangeChangeDescriptors();j=j||"";if(!i.has(j)){i.set(j,{isActive:false,changeListeners:[],willChangeListeners:[]})}return i.get(j)};g.prototype.addRangeChangeListener=function(m,j,l){if(!this.isObservable&&this.makeObservable){this.makeObservable()}var n=this.getRangeChangeDescriptor(j);var k;if(l){k=n.willChangeListeners}else{k=n.changeListeners}k.push(m);Object.defineProperty(this,"dispatchesRangeChanges",{value:true,writable:true,configurable:true,enumerable:false});var i=this;return function o(){if(!i){return}i.removeRangeChangeListener(m,j,l);i=null}};g.prototype.removeRangeChangeListener=function(m,j,l){var n=this.getRangeChangeDescriptor(j);var k;if(l){k=n.willChangeListeners}else{k=n.changeListeners}var i=k.lastIndexOf(m);if(i===-1){throw new Error("Can't remove range change listener: does not exist: token "+JSON.stringify(j))}k.splice(i,1)};g.prototype.dispatchRangeChange=function(n,k,i,l){var j=this.getAllRangeChangeDescriptors();var m="Range"+(l?"WillChange":"Change");j.forEach(function(r,o){if(r.isActive){return}else{r.isActive=true}var p;if(l){p=r.willChangeListeners}else{p=r.changeListeners}var q="handle"+(o.slice(0,1).toUpperCase()+o.slice(1))+m;try{p.slice().forEach(function(s){if(p.indexOf(s)<0){return}if(s[q]){s[q](n,k,i,this,l)}else{if(s.call){s.call(this,n,k,i,this,l)}else{throw new Error("Handler "+s+" has no method "+q+" and is not callable")}}},this)}finally{r.isActive=false}},this)};g.prototype.addBeforeRangeChangeListener=function(j,i){return this.addRangeChangeListener(j,i,true)};g.prototype.removeBeforeRangeChangeListener=function(j,i){return this.removeRangeChangeListener(j,i,true)};g.prototype.dispatchBeforeRangeChange=function(k,j,i){return this.dispatchRangeChange(k,j,i,true)}},{"../dict":3,"weak-map":19}],13:[function(f,c,h){var d=f("./shim-function");var j=f("./generic-collection");var b=f("./generic-order");var l=f("weak-map");c.exports=Array;var a=Array.prototype.splice;var k=Array.prototype.slice;Array.empty=[];if(Object.freeze){Object.freeze(Array.empty)}Array.from=function(m){var n=[];n.addEach(m);return n};Array.unzip=function(q){var o=[];var p=Infinity;for(var n=0;n<q.length;n++){var r=q[n];q[n]=r.toArray();if(r.length<p){p=r.length}}for(var n=0;n<q.length;n++){var r=q[n];for(var m=0;m<r.length;m++){if(m<p&&m in r){o[m]=o[m]||[];o[m][n]=r[m]}}}return o};function i(m,n){Object.defineProperty(Array.prototype,m,{value:n,writable:true,configurable:true,enumerable:false})}i("addEach",j.prototype.addEach);i("deleteEach",j.prototype.deleteEach);i("toArray",j.prototype.toArray);i("toObject",j.prototype.toObject);i("all",j.prototype.all);i("any",j.prototype.any);i("min",j.prototype.min);i("max",j.prototype.max);i("sum",j.prototype.sum);i("average",j.prototype.average);i("only",j.prototype.only);i("flatten",j.prototype.flatten);i("zip",j.prototype.zip);i("enumerate",j.prototype.enumerate);i("group",j.prototype.group);i("sorted",j.prototype.sorted);i("reversed",j.prototype.reversed);i("constructClone",function(m){var n=new this.constructor();n.addEach(m);return n});i("has",function(n,m){return this.find(n,m)!==-1});i("get",function(n,m){if(+n!==n){throw new Error("Indicies must be numbers")}if(!n in this){return m}else{return this[n]}});i("set",function(m,n){this[m]=n;return true});i("add",function(m){this.push(m);return true});i("delete",function(o,n){var m=this.find(o,n);if(m!==-1){this.splice(m,1);return true}return false});i("deleteAll",function(p,o){o=o||this.contentEquals||Object.equals;var n=0;for(var m=0;m<this.length;){if(o(p,this[m])){this.swap(m,1);n++}else{m++}}return n});i("find",function(o,n){n=n||this.contentEquals||Object.equals;for(var m=0;m<this.length;m++){if(m in this&&n(o,this[m])){return m}}return -1});i("findLast",function(o,n){n=n||this.contentEquals||Object.equals;var m=this.length;do{m--;if(m in this&&n(this[m],o)){return m}}while(m>0);return -1});i("swap",function(t,r,s){var n,q,o,m,p;if(t>this.length){this.length=t}if(typeof s!=="undefined"){n=[t,r];if(!Array.isArray(s)){s=k.call(s)}o=0;q=s.length;if(q<1000){for(o;o<q;o++){n[o+2]=s[o]}return a.apply(this,n)}else{p=a.apply(this,n);for(o;o<q;){n=[t+o,0];for(m=2;m<1002&&o<q;m++,o++){n[m]=s[o]}a.apply(this,n)}return p}}else{if(typeof r!=="undefined"){return a.call(this,t,r)}else{if(typeof t!=="undefined"){return a.call(this,t)}else{return[]}}}});i("peek",function(){return this[0]});i("poke",function(m){if(this.length>0){this[0]=m}});i("peekBack",function(){if(this.length>0){return this[this.length-1]}});i("pokeBack",function(m){if(this.length>0){this[this.length-1]=m}});i("one",function(){for(var m in this){if(Object.owns(this,m)){return this[m]}}});if(!Array.prototype.clear){i("clear",function(){this.length=0;return this})}i("compare",function(p,r){r=r||Object.compare;var n;var o;var m;var s;var q;if(this===p){return 0}if(!p||!Array.isArray(p)){return b.prototype.compare.call(this,p,r)}o=Math.min(this.length,p.length);for(n=0;n<o;n++){if(n in this){if(!(n in p)){return -1}else{m=this[n];s=p[n];q=r(m,s);if(q){return q}}}else{if(n in p){return 1}}}return this.length-p.length});i("equals",function(q,p){p=p||Object.equals;var n=0;var o=this.length;var r;var m;if(this===q){return true}if(!q||!Array.isArray(q)){return b.prototype.equals.call(this,q)}if(o!==q.length){return false}else{for(;n<o;++n){if(n in this){if(!(n in q)){return false}r=this[n];m=q[n];if(!p(r,m)){return false}}else{if(n in q){return false}}}}return true});i("clone",function(o,m){if(o==null){o=Infinity}else{if(o===0){return this}}m=m||new l();if(m.has(this)){return m.get(this)}var p=new Array(this.length);m.set(this,p);for(var n in this){p[n]=Object.clone(this[n],o-1,m)}return p});i("iterate",function(n,m){return new g(this,n,m)});i("Iterator",g);function g(o,n,m){this.array=o;this.start=n==null?0:n;this.end=m}g.prototype.__iterationObject=null;Object.defineProperty(g.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:false,value:null})}});g.prototype.next=function(){if(this.start===(this.end==null?this.array.length:this.end)){this._iterationObject.done=true;this._iterationObject.value=void 0}else{this._iterationObject.value=this.array[this.start++]}return this._iterationObject}},{"./generic-collection":5,"./generic-order":7,"./shim-function":14,"weak-map":19}],14:[function(b,c,a){c.exports=Function;Function.noop=function(){};Function.identity=function(d){return d};Function.by=function(g,f){f=f||Object.compare;g=g||Function.identity;var d=function(i,h){return f(g(i),g(h))};d.compare=f;d.by=g;return d};Function.get=function(d){return function(f){return Object.get(f,d)}}},{}],15:[function(b,c,a){var d=b("weak-map");c.exports=Object;Object.empty=Object.freeze(Object.create(null));Object.isObject=function(h){return Object(h)===h};Object.getValueOf=function(h){if(h&&typeof h.valueOf==="function"){h=h.valueOf()}return h};var f=new d();Object.hash=function(h){if(h&&typeof h.hash==="function"){return""+h.hash()}else{if(Object(h)===h){if(!f.has(h)){f.set(h,Math.random().toString(36).slice(2))}return f.get(h)}else{return""+h}}};var g=Object.prototype.hasOwnProperty;Object.owns=function(h,i){return g.call(h,i)};Object.has=function(h,i){if(typeof h!=="object"){throw new Error("Object.has can't accept non-object: "+typeof h)}if(h&&typeof h.has==="function"){return h.has(i)}else{if(typeof i==="string"){return i in h&&h[i]!==Object.prototype[i]}else{throw new Error("Key must be a string for Object.has on plain objects")}}};Object.get=function(h,i,j){if(typeof h!=="object"){throw new Error("Object.get can't accept non-object: "+typeof h)}if(h&&typeof h.get==="function"){return h.get(i,j)}else{if(Object.has(h,i)){return h[i]}else{return j}}};Object.set=function(h,i,j){if(h&&typeof h.set==="function"){h.set(i,j)}else{h[i]=j}};Object.addEach=function(j,i){if(!i){}else{if(typeof i.forEach==="function"&&!i.hasOwnProperty("forEach")){if(i.isMap===true){i.forEach(function(l,k){j[k]=l})}else{i.forEach(function(k){j[k[0]]=k[1]})}}else{if(typeof i.length==="number"){for(var h=0;h<i.length;h++){j[h]=i[h]}}else{Object.keys(i).forEach(function(k){j[k]=i[k]})}}}return j};Object.forEach=function(h,n,l){var m=Object.keys(h),k=0,j;for(;(j=m[k]);k++){n.call(l,h[j],j,h)}};Object.map=function(j,o,m){var n=Object.keys(j),l=0,h=[],k;for(;(k=n[l]);l++){h.push(o.call(m,j[k],k,j))}return h};Object.values=function(h){return Object.map(h,Function.identity)};Object.concat=function(){var h={};for(var j=0;j<arguments.length;j++){Object.addEach(h,arguments[j])}return h};Object.from=Object.concat;Object.is=function(h,i){if(h===i){return h!==0||1/h===1/i}return h!==h&&i!==i};Object.equals=function(i,h,l,j){l=l||Object.equals;i=Object.getValueOf(i);h=Object.getValueOf(h);if(i===h){return true}if(Object.isObject(i)){j=j||new d();if(j.has(i)){return true}j.set(i,true)}if(Object.isObject(i)&&typeof i.equals==="function"){return i.equals(h,l,j)}if(Object.isObject(h)&&typeof h.equals==="function"){return h.equals(i,l,j)}if(Object.isObject(i)&&Object.isObject(h)){if(Object.getPrototypeOf(i)===Object.prototype&&Object.getPrototypeOf(h)===Object.prototype){for(var k in i){if(!l(i[k],h[k],l,j)){return false}}for(var k in h){if(!(k in i)||!l(h[k],i[k],l,j)){return false}}return true}}if(i!==i&&h!==h){return true}if(!i||!h){return i===h}return false};Object.compare=function(j,h){j=Object.getValueOf(j);h=Object.getValueOf(h);if(j===h){return 0}var i=typeof j;var k=typeof h;if(i==="number"&&k==="number"){return j-h}if(i==="string"&&k==="string"){return j<h?-Infinity:Infinity}if(j&&typeof j.compare==="function"){return j.compare(h)}if(h&&typeof h.compare==="function"){return -h.compare(j)}return 0};Object.clone=function(k,l,h){k=Object.getValueOf(k);h=h||new d();if(l===undefined){l=Infinity}else{if(l===0){return k}}if(Object.isObject(k)){if(!h.has(k)){if(k&&typeof k.clone==="function"){h.set(k,k.clone(l,h))}else{var i=Object.getPrototypeOf(k);if(i===null||i===Object.prototype){var m=Object.create(i);h.set(k,m);for(var j in k){m[j]=Object.clone(k[j],l-1,h)}}else{throw new Error("Can't clone "+k)}}}return h.get(k)}return k};Object.clear=function(h){if(h&&typeof h.clear==="function"){h.clear()}else{var k=Object.keys(h),j=k.length;while(j){j--;delete h[k[j]]}}return h}},{"weak-map":19}],16:[function(c,d,a){if(!RegExp.escape){var b=/[-[\]{}()*+?.\\^$|,#\s]/g;RegExp.escape=function(f){return f.replace(b,"\\$&")}}},{}],17:[function(f,g,d){var h=f("./shim-array");var c=f("./shim-object");var a=f("./shim-function");var b=f("./shim-regexp")},{"./shim-array":13,"./shim-function":14,"./shim-object":15,"./shim-regexp":16}],18:[function(c,d,b){d.exports=a;function a(){}a.ascii={intersection:"+",through:"-",branchUp:"+",branchDown:"+",fromBelow:".",fromAbove:"'",fromBoth:"+",strafe:"|"};a.unicodeRound={intersection:"\u254b",through:"\u2501",branchUp:"\u253b",branchDown:"\u2533",fromBelow:"\u256d",fromAbove:"\u2570",fromBoth:"\u2523",strafe:"\u2503"};a.unicodeSharp={intersection:"\u254b",through:"\u2501",branchUp:"\u253b",branchDown:"\u2533",fromBelow:"\u250f",fromAbove:"\u2517",fromBoth:"\u2523",strafe:"\u2503"}},{}],19:[function(c,d,b){(function a(){if(typeof ses!=="undefined"&&ses.ok&&!ses.ok()){return}function y(G){if(G.permitHostObjects___){G.permitHostObjects___(y)}}if(typeof ses!=="undefined"){ses.weakMapPermitHostObjects=y}var m=false;if(typeof WeakMap==="function"){var p=WeakMap;if(typeof navigator!=="undefined"&&/Firefox/.test(navigator.userAgent)){}else{var j=new p();var l=Object.freeze({});j.set(l,1);if(j.get(l)!==1){m=true}else{d.exports=WeakMap;return}}}var E=Object.prototype.hasOwnProperty;var o=Object.getOwnPropertyNames;var s=Object.defineProperty;var v=Object.isExtensible;var D="weakmap:";var g=D+"ident:"+Math.random()+"___";if(typeof crypto!=="undefined"&&typeof crypto.getRandomValues==="function"&&typeof ArrayBuffer==="function"&&typeof Uint8Array==="function"){var C=new ArrayBuffer(25);var k=new Uint8Array(C);crypto.getRandomValues(k);g=D+"rand:"+Array.prototype.map.call(k,function(G){return(G%36).toString(36)}).join("")+"___"}function w(G){return !(G.substr(0,D.length)==D&&G.substr(G.length-3)==="___")}s(Object,"getOwnPropertyNames",{value:function u(G){return o(G).filter(w)}});if("getPropertyNames" in Object){var z=Object.getPropertyNames;s(Object,"getPropertyNames",{value:function r(G){return z(G).filter(w)}})}function B(H){if(H!==Object(H)){throw new TypeError("Not an object: "+H)}var I=H[g];if(I&&I.key===H){return I}if(!v(H)){return void 0}I={key:H};try{s(H,g,{value:I,writable:false,enumerable:false,configurable:false});return I}catch(G){return void 0}}(function(){var J=Object.freeze;s(Object,"freeze",{value:function G(M){B(M);return J(M)}});var L=Object.seal;s(Object,"seal",{value:function H(M){B(M);return L(M)}});var K=Object.preventExtensions;s(Object,"preventExtensions",{value:function I(M){B(M);return K(M)}})})();function h(G){G.prototype=null;return Object.freeze(G)}var A=false;function t(){if(!A&&typeof console!=="undefined"){A=true;console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future.")}}var q=0;var i=function(){if(!(this instanceof i)){t()}var K=[];var H=[];var M=q++;function J(O,Q){var N;var P=B(O);if(P){return M in P?P[M]:Q}else{N=K.indexOf(O);return N>=0?H[N]:Q}}function I(N){var O=B(N);if(O){return M in O}else{return K.indexOf(N)>=0}}function G(O,Q){var N;var P=B(O);if(P){P[M]=Q}else{N=K.indexOf(O);if(N>=0){H[N]=Q}else{N=K.length;H[N]=Q;K[N]=O}}return this}function L(O){var P=B(O);var N,Q;if(P){return M in P&&delete P[M]}else{N=K.indexOf(O);if(N<0){return false}Q=K.length-1;K[N]=void 0;H[N]=H[Q];K[N]=K[Q];K.length=Q;H.length=Q;return true}}return Object.create(i.prototype,{get___:{value:h(J)},has___:{value:h(I)},set___:{value:h(G)},delete___:{value:h(L)}})};i.prototype=Object.create(Object.prototype,{get:{value:function x(G,H){return this.get___(G,H)},writable:true,configurable:true},has:{value:function f(G){return this.has___(G)},writable:true,configurable:true},set:{value:function n(G,H){return this.set___(G,H)},writable:true,configurable:true},"delete":{value:function F(G){return this.delete___(G)},writable:true,configurable:true}});if(typeof p==="function"){(function(){if(m&&typeof Proxy!=="undefined"){Proxy=undefined}function G(){if(!(this instanceof i)){t()}var J=new p();var L=undefined;var N=false;function I(O,P){if(L){return J.has(O)?J.get(O):L.get___(O,P)}else{return J.get(O,P)}}function H(O){return J.has(O)||(L?L.has___(O):false)}var M;if(m){M=function(O,P){J.set(O,P);if(!J.has(O)){if(!L){L=new i()}L.set(O,P)}return this}}else{M=function(O,P){if(N){try{J.set(O,P)}catch(Q){if(!L){L=new i()}L.set___(O,P)}}else{J.set(O,P)}return this}}function K(P){var O=!!J["delete"](P);if(L){return L.delete___(P)||O}return O}return Object.create(i.prototype,{get___:{value:h(I)},has___:{value:h(H)},set___:{value:h(M)},delete___:{value:h(K)},permitHostObjects___:{value:h(function(O){if(O===y){N=true}else{throw new Error("bogus call to permitHostObjects___")}})}})}G.prototype=i.prototype;d.exports=G;Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:false,configurable:true,writable:true})})()}else{if(typeof Proxy!=="undefined"){Proxy=undefined}d.exports=i}})()},{}]},{},[1]);