exec_module({name:"Construction notifications",desc:"Creates toast & sound notifications when house construction finishes",dependencies:{fn:["parseTimeStringLong","gh_url","notification"],classes:["AloTimer","Interval","buzz"]},settings:{desc:{Sound:"Play a sound when construction finishes",toast:"Display a toast when construction finishes"},defaults:{sound:true,toast:true}},load:function(d,b){function c(){d.post("/house.php")}function a(){if(!b.vars.notified){if(b.settings.sound){b.vars.sfx.play()}if(b.settings.toast){b.dependencies.fn.notification("Construction finished",{title:b.spec.name})}}b.vars.notified=true}function e(g){var f=new b.dependencies.classes.Interval(b.spec.name);f.clear();if(g.indexOf("available again")!==-1){var h=new b.dependencies.classes.AloTimer(b.dependencies.fn.parseTimeStringLong(g));f.set(function(){if(h.isFinished()){f.clear();a()}else{b.vars.notified=false}},1000)}else{if(g.indexOf("are available")!==-1){a()}else{setTimeout(c,3000)}}}b.vars.notified=false;b.vars={notified:false,house_requery:function(f,h,g){if(g.url.indexOf("house")!==-1&&typeof(h.responseJSON)!=="undefined"&&typeof(h.responseJSON.m)!=="undefined"){e(h.responseJSON.m)}},sfx:new b.dependencies.classes.buzz.sound(b.dependencies.fn.gh_url("res/sfx/circ_saw.wav"))};d(document).ajaxComplete(b.vars.house_requery);d.ajax("/house.php",{global:false}).done(function(f){if(typeof(f.m)!=="undefined"){e(f.m)}})},unload:function(b,a){b(document).unbind("ajaxComplete",a.vars.house_requery)}});