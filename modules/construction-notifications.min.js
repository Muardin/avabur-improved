exec_module({name:"Construction notifications",desc:"Creates toast & sound notifications when house construction finishes",dependencies:{fn:["parseTimeStringLong","gh_url","notification"],classes:["AloTimer","Interval","SFX"]},settings:{desc:{Sound:"Play a sound when construction finishes",toast:"Display a toast when construction finishes"},defaults:{sound:true,toast:true}},funcs:{notify:function(a){if(!a.vars.notified){if(a.settings.sound){a.vars.sfx.play()}if(a.settings.toast){a.dependencies.fn.notification("Construction finished",{title:a.spec.name})}}a.vars.notified=true},handle_text:function(c,b){var a=new b.dependencies.classes.Interval(b.spec.name);a.clear();if(c.indexOf("available again")!==-1){var d=new b.dependencies.classes.AloTimer(b.dependencies.fn.parseTimeStringLong(c));a.set(function(){if(d.isFinished()){a.clear();b.spec.funcs.notify(b)}else{b.vars.notified=false}},1000)}else{if(c.indexOf("are available")!==-1){b.spec.funcs.notify(b)}else{setTimeout(refresh,3000)}}}},load:function(c,a){function b(){c.post("/house.php")}a.vars={notified:false,house_requery:function(d,f,e){if(e.url.indexOf("house")!==-1&&typeof(f.responseJSON)!=="undefined"&&typeof(f.responseJSON.m)!=="undefined"){a.spec.vars.handle_text(f.responseJSON.m,a)}},sfx:new a.dependencies.classes.SFX(a.dependencies.fn.gh_url("res/sfx/circ_saw.wav"))};c(document).ajaxComplete(a.vars.house_requery);c.ajax("/house.php",{global:false}).done(function(d){if(typeof(d.m)!=="undefined"){a.spec.vars.handle_text(d.m,a)}})},unload:function(b,a){b(document).unbind("ajaxComplete",a.vars.house_requery)}});