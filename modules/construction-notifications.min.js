exec_module({name:"Construction notifications",desc:"Creates toast & sound notifications when house construction finishes",dependencies:{fn:["parseTimeStringLong"],classes:["AloTimer","Interval"]},load:function(c,a){function b(){c.post("/house.php")}a.vars={notified:false,house_requery:function(d,g,f){if(f.url.indexOf("house")!==-1&&typeof(g.responseJSON)!=="undefined"&&typeof(g.responseJSON.m)!=="undefined"){var h=g.responseJSON.m,e=new a.dependencies.classes.Interval(a.spec.name);e.clear();if(h.indexOf("available again")!==-1){var i=new a.dependencies.classes.AloTimer(a.dependencies.fn.parseTimeStringLong(h));e.set(function(){if(i.isFinished()){e.clear();console.debug("Construction: available (NOT direct). Notified: "+(a.vars.notified?"Y":"N"));a.vars.notified=true}else{console.debug("Construction: available in "+i.toString()+". Notified: "+(a.vars.notified?"Y":"N"));a.vars.notified=false}},1000)}else{if(h.indexOf("are available")!==-1){console.debug("Construction: available (direct). Notified: "+(a.vars.notified?"Y":"N"));a.vars.notified=true}else{setTimeout(b,3000);console.debug("Construction: fuck knows. Notified: "+(a.vars.notified?"Y":"N"))}}}}};c(document).ajaxComplete(a.vars.house_requery);b()},unload:function(b,a){b(document).unbind("ajaxComplete",a.vars.house_requery)}});