exec_module({name:"House notifications",desc:"Creates toast & sound notifications when house construction and/or Harvestron finish",dependencies:{fn:["parseTimeStringLong","gh_url","notification"],classes:["AloTimer","Interval","SFX"]},settings:{desc:{"Construction sound":"Play a sound when construction finishes","Construction toast":"Display a toast when construction finishes"},defaults:{"Construction sound":true,"Construction toast":true},demo:{"Construction sound":function(c,b,a){a.vars.sfx.play()},"Construction toast":function(c,b,a){a.dependencies.fn.notification("Construction finished",a.spec.name)}}},funcs:{click_house:function(){document.getElementById("header_house").click()},notify:function(a){if(!a.vars.notified){if(a.settings["Construction sound"]){a.vars.sfx.play()}if(a.settings["Construction toast"]){a.dependencies.fn.notification("Construction finished",a.spec.name,{onclick:a.spec.funcs.click_house})}}a.vars.notified=true}},load:function(c,a){function b(){c.ajax("/house.php",{global:false}).done(function(e){if(typeof(e.m)!=="undefined"){d(e.m)}})}function d(f){var e=new a.dependencies.classes.Interval(a.spec.name);e.clear();if(f.indexOf("available again")!==-1){var g=new a.dependencies.classes.AloTimer(a.dependencies.fn.parseTimeStringLong(f));e.set(function(){if(g.isFinished()){e.clear();a.spec.funcs.notify(a)}else{a.vars.notified=false}},1000)}else{if(f.indexOf("are available")!==-1){a.spec.funcs.notify(a)}else{setTimeout(b,1000)}}}a.vars={notified:false,house_requery:function(e,g,f){if(f.url.indexOf("house")!==-1&&typeof(g.responseJSON)!=="undefined"&&typeof(g.responseJSON.m)!=="undefined"){d(g.responseJSON.m)}},sfx:new a.dependencies.classes.SFX(a.dependencies.fn.gh_url("res/sfx/circ_saw.wav"))};c(document).ajaxComplete(a.vars.house_requery);b()},unload:function(b,a){b(document).unbind("ajaxComplete",a.vars.house_requery)}});