exec_module({name:"House timers",desc:"Shows house construction timers without the need for an alarm clock",dependencies:{fn:["parseTimeStringLong"],classes:["AloTimer","CssManager","Interval"]},load:function(e,d){var b=e("<div class='col-xs-6 col-md-12'/>");function c(){e.post("/house.php")}function a(f){f.clear();d.vars.paneSpan.addClass("avi-highlight").html(e('<span data-delegate-click="#header_house" style="cursor:pointer;text-decoration:underline;padding-right:5px">Ready!</span>')).append(e("<a href='javascript:;'>(refresh)</a>").click(c))}d.vars={paneLabel:b.clone().addClass("col-lg-5 gold").text("Construction:"),paneSpan:e("<span>House unavailable</span>"),house_requery:function(f,i,h){if(h.url.indexOf("house")!==-1&&typeof(i.responseJSON)!=="undefined"&&typeof(i.responseJSON.m)!=="undefined"){var j=i.responseJSON.m,g=new d.dependencies.classes.Interval(d.spec.name);g.clear();if(j.indexOf("available again")!==-1){var k=new d.dependencies.classes.AloTimer(d.dependencies.fn.parseTimeStringLong(j));g.set(function(){if(k.isFinished()){a(g)}else{d.vars.paneSpan.removeClass("avi-highlight").text(k.toString())}},1000)}else{if(j.indexOf("are available")!==-1){a(g)}else{setTimeout(c,3000)}}}},css:(new d.dependencies.classes.CssManager()).setRules({"#constructionNotifier,#houseTimerTable [data-typeid='Construction']":{display:"none !important"}}).addToDOM()};d.vars.paneSpanContainer=b.clone().addClass("col-lg-7").html(d.vars.paneSpan);e("#houseTimerInfo").addClass("avi-force-block");e("#houseTimerTable").prepend(d.vars.paneLabel,d.vars.paneSpanContainer);e(document).ajaxComplete(d.vars.house_requery);c()},unload:function(b,a){a.vars.paneLabel.remove();a.vars.paneSpanContainer.remove();a.vars.css.removeFromDOM();b(document).unbind("ajaxComplete",a.vars.house_requery);b("#houseTimerInfo").removeClass("avi-force-block");(new a.dependencies.classes.Interval(a.spec.name)).clear()}});