exec_module({name:"Market tooltips",desc:"Performs a market price lookup when you hover a supported item",dependencies:{fn:["analysePrice","numberWithCommas","openMarket"],classes:["Request"]},vars:{CACHE_TTL:1/3600*60,html:'<table class="avi" style="margin:auto"><thead><tr><th colspan="3">Current market price (1st page)</th></tr><tr><th>Low</th><th>Average</th><th>High</th></tr></thead><tbody><tr data-id="prices"><td></td><td></td><td></td></tr></tbody></table>',tradeskill_mats:{"Aberration Mind Source":0,"Animal Eye":10,"Animal Tongue":11,"Animal Tooth":12,"Animal Wing":13,"Beast Fur":20,"Beast Limb":21,"Beast Tooth":22,"Beast Wing":23,"Bird Nest":122,"Chunk of Coal":130,"Chunk of Graphite":132,"Construct Power":30,"Copper Ore":133,"Dragon Eye":40,"Dragon Scale":41,"Dragon Tail":42,"Elemental Energy":50,"Fish Fin":112,"Golden Apple":121,Honeycomb:123,"Humanoid Bone":60,"Humanoid Flesh":61,"Humanoid Limb":62,"Lucky Coin":141,"Magical Stone":140,"Octopus Ink":110,"Ooze Gel":70,"Plant Branch":80,"Plant Leaf":81,"Plant Root":82,"Plant Vine":83,"Protection Stone":142,"Rainbow Shard":131,"Rune Stone":143,"Serpent Eye":90,"Serpent Tail":91,"Serpent Tongue":92,"Squid Tentacle":113,"Turtle Shell":111,"Vermin Eye":100,"Vermin Tooth":101,"Yellow Pollen":120}},load:function(f,d){function h(k){var l=d.dependencies.fn.analysePrice(k.l);d.vars.dom.low_currency.text(d.dependencies.fn.numberWithCommas(l.low));d.vars.dom.avg_currency.text(d.dependencies.fn.numberWithCommas(l.avg));d.vars.dom.high_currency.text(d.dependencies.fn.numberWithCommas(l.high))}function a(){b.click();d.dependencies.fn.openMarket("Ingredients")}function j(){const l=f(this),k=l.text().trim();if(typeof(d.spec.vars.tradeskill_mats[k])==="undefined"){Toast.error("Failed to lookup "+k+": ID not found")}else{(new d.dependencies.classes.Request("/market.php",d.spec.vars.CACHE_TTL)).post({type:"ingredient",page:0,q:0,ll:0,hl:0,st:d.spec.vars.tradeskill_mats[k]}).done(function(n){const p=l.attr("aria-describedby"),m=f("#"+p);if(p&&m.length){const q=d.dependencies.fn.analysePrice(n.l),o=m.find("tr[data-id=prices]>td");o.first().text(d.dependencies.fn.numberWithCommas(q.low)).next().text(d.dependencies.fn.numberWithCommas(q.avg)).next().text(d.dependencies.fn.numberWithCommas(q.high))}})}}function i(){const m=f(this),l=m.text().trim(),k=f("<span>"+l+"</span>");m.html(k);k.popover({title:l,html:true,trigger:"hover",container:"body",viewport:{selector:"body",padding:0},placement:"auto right",content:c});k.mouseenter(j).css("cursor","pointer").click(a)}var g=f("#currencyTooltipMarketable"),c=f("#currencyTooltip"),b=f("#modalBackground"),e;d.vars.dom={};d.vars.observers={currency_tooltips:new MutationObserver(function(l){if(l.length&&g.is(":visible")){const k=g.attr("class"),m=k.replace("crystals","premium").replace("materials","weapon_scraps").replace("fragments","gem_fragments");d.vars.dom.row_currency.attr("class",k);if(k==="gold"){e.text("N/A")}else{e.text(" ");(new d.dependencies.classes.Request("/market.php",d.spec.vars.CACHE_TTL)).post({type:"currency",page:0,st:m}).done(h)}}}),inventory_table:new MutationObserver(function(l){for(var m=0;m<l.length;m++){if(l[m].addedNodes.length){for(var o=0;o<l[m].addedNodes.length;o++){if(l[m].addedNodes[o] instanceof HTMLTableSectionElement){const k=f(l[m].addedNodes[o]);if(k.find("th:contains(Ingredient)").length){k.find(">tr>[data-th=Item]").each(i)}break}}break}}})};d.vars.dom.table_currency=f(d.spec.vars.html);d.vars.dom.row_currency=d.vars.dom.table_currency.find("tr[data-id=prices]");e=d.vars.dom.row_currency.find(">td");d.vars.dom.low_currency=e.first();d.vars.dom.avg_currency=d.vars.dom.low_currency.next();d.vars.dom.high_currency=d.vars.dom.avg_currency.next();c.append(d.vars.dom.table_currency);d.vars.observers.currency_tooltips.observe(c[0],{attributes:true});d.vars.observers.inventory_table.observe(document.querySelector("#inventoryTable"),{attributes:true,characterData:true})},unload:function(d,c){if(typeof(c.vars.dom)!=="undefined"){for(var b in c.vars.dom){if(c.vars.dom.hasOwnProperty(b)){c.vars.dom[b].remove();delete c.vars.dom[b]}}}if(typeof(c.vars.observers)!=="undefined"){for(var a in c.vars.observers){if(c.vars.observers.hasOwnProperty(a)){c.vars.observers[a].disconnect()}}}}});